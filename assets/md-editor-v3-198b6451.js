import{R as Se,I as Be,L as wl,$ as Tl,H as _l,x as Sl}from"./@vavt-12646459.js";import{d as N,m as I,M as s,G as z,r as B,w as S,t as R,_ as pe,$ as Re,K as re,k as G,E as te,V as xl,X as El,Q as xe,p as Q,v as ie,a0 as Il}from"./@vue-defa2bbc.js";import{_ as Ll,E as ae,H as rl,s as sl,k as Hl,d as Al,h as Ml,i as Fl,a as Mt,m as Pl,l as Bl,u as Rl,r as Nl,b as Dl,c as ee,e as Ae,f as jl,p as Ol,g as Vl,C as me,S as Wl}from"./@codemirror-453f4d42.js";import{a as p}from"./@lezer-9e9c314f.js";import{m as zl}from"./medium-zoom-45da89b9.js";import{a as Ul}from"./copy-to-clipboard-ca358197.js";import{M as Gl}from"./markdown-it-dbab3289.js";import{r as ql}from"./markdown-it-image-figures-6b4113de.js";import{m as Kl}from"./markdown-it-task-lists-1295841e.js";import{m as Zl}from"./markdown-it-xss-e9dc809c.js";import{L as Xl}from"./lru-cache-b2f61452.js";const c="md-editor",Jl="https://at.alicdn.com/t/c/font_2605852_prouiefeic.js",Yl="https://at.alicdn.com/t/c/font_2605852_prouiefeic.css",P="https://cdnjs.cloudflare.com/ajax/libs",Ql=`${P}/highlight.js/11.8.0/highlight.min.js`,Ft={main:`${P}/prettier/2.8.0/standalone.js`,markdown:`${P}/prettier/2.8.0/parser-markdown.js`},Pt={css:`${P}/cropperjs/1.5.13/cropper.min.css`,js:`${P}/cropperjs/1.5.13/cropper.min.js`},eo=`${P}/screenfull.js/5.2.0/screenfull.min.js`,cl=["bold","underline","italic","strikeThrough","-","title","sub","sup","quote","unorderedList","orderedList","task","-","codeRow","code","link","image","table","mermaid","katex","-","revoke","next","save","=","prettier","pageFullscreen","fullscreen","preview","htmlPreview","catalog","github"],ul=["markdownTotal","=","scrollSwitch"],Bt={"zh-CN":{toolbarTips:{bold:"加粗",underline:"下划线",italic:"斜体",strikeThrough:"删除线",title:"标题",sub:"下标",sup:"上标",quote:"引用",unorderedList:"无序列表",orderedList:"有序列表",task:"任务列表",codeRow:"行内代码",code:"块级代码",link:"链接",image:"图片",table:"表格",mermaid:"mermaid图",katex:"katex公式",revoke:"后退",next:"前进",save:"保存",prettier:"美化",pageFullscreen:"浏览器全屏",fullscreen:"屏幕全屏",preview:"预览",htmlPreview:"html代码预览",catalog:"目录",github:"源码地址"},titleItem:{h1:"一级标题",h2:"二级标题",h3:"三级标题",h4:"四级标题",h5:"五级标题",h6:"六级标题"},imgTitleItem:{link:"添加链接",upload:"上传图片",clip2upload:"裁剪上传"},linkModalTips:{linkTitle:"添加链接",imageTitle:"添加图片",descLabel:"链接描述：",descLabelPlaceHolder:"请输入描述...",urlLabel:"链接地址：",urlLabelPlaceHolder:"请输入链接...",buttonOK:"确定"},clipModalTips:{title:"裁剪图片上传",buttonUpload:"上传"},copyCode:{text:"复制代码",successTips:"已复制！",failTips:"复制失败！"},mermaid:{flow:"流程图",sequence:"时序图",gantt:"甘特图",class:"类图",state:"状态图",pie:"饼图",relationship:"关系图",journey:"旅程图"},katex:{inline:"行内公式",block:"块级公式"},footer:{markdownTotal:"字数",scrollAuto:"同步滚动"}},"en-US":{toolbarTips:{bold:"bold",underline:"underline",italic:"italic",strikeThrough:"strikeThrough",title:"title",sub:"subscript",sup:"superscript",quote:"quote",unorderedList:"unordered list",orderedList:"ordered list",task:"task list",codeRow:"inline code",code:"block-level code",link:"link",image:"image",table:"table",mermaid:"mermaid",katex:"formula",revoke:"revoke",next:"undo revoke",save:"save",prettier:"prettier",pageFullscreen:"fullscreen in page",fullscreen:"fullscreen",preview:"preview",htmlPreview:"html preview",catalog:"catalog",github:"source code"},titleItem:{h1:"Lv1 Heading",h2:"Lv2 Heading",h3:"Lv3 Heading",h4:"Lv4 Heading",h5:"Lv5 Heading",h6:"Lv6 Heading"},imgTitleItem:{link:"Add Img Link",upload:"Upload Img",clip2upload:"Clip Upload"},linkModalTips:{linkTitle:"Add Link",imageTitle:"Add Image",descLabel:"Desc:",descLabelPlaceHolder:"Enter a description...",urlLabel:"Link:",urlLabelPlaceHolder:"Enter a link...",buttonOK:"OK"},clipModalTips:{title:"Crop Image",buttonUpload:"Upload"},copyCode:{text:"Copy",successTips:"Copied!",failTips:"Copy failed!"},mermaid:{flow:"flow",sequence:"sequence",gantt:"gantt",class:"class",state:"state",pie:"pie",relationship:"relationship",journey:"journey"},katex:{inline:"inline",block:"block"},footer:{markdownTotal:"Character Count",scrollAuto:"Scroll Auto"}}},to=`${P}/mermaid/10.6.1/mermaid.esm.min.mjs`,Rt={js:`${P}/KaTeX/0.16.9/katex.min.js`,css:`${P}/KaTeX/0.16.9/katex.min.css`},Nt={a11y:{light:`${P}/highlight.js/11.8.0/styles/a11y-light.min.css`,dark:`${P}/highlight.js/11.8.0/styles/a11y-dark.min.css`},atom:{light:`${P}/highlight.js/11.8.0/styles/atom-one-light.min.css`,dark:`${P}/highlight.js/11.8.0/styles/atom-one-dark.min.css`},github:{light:`${P}/highlight.js/11.8.0/styles/github.min.css`,dark:`${P}/highlight.js/11.8.0/styles/github-dark.min.css`},gradient:{light:`${P}/highlight.js/11.8.0/styles/gradient-light.min.css`,dark:`${P}/highlight.js/11.8.0/styles/gradient-dark.min.css`},kimbie:{light:`${P}/highlight.js/11.8.0/styles/kimbie-light.min.css`,dark:`${P}/highlight.js/11.8.0/styles/kimbie-dark.min.css`},paraiso:{light:`${P}/highlight.js/11.8.0/styles/paraiso-light.min.css`,dark:`${P}/highlight.js/11.8.0/styles/paraiso-dark.min.css`},qtcreator:{light:`${P}/highlight.js/11.8.0/styles/qtcreator-light.min.css`,dark:`${P}/highlight.js/11.8.0/styles/qtcreator-dark.min.css`},stackoverflow:{light:`${P}/highlight.js/11.8.0/styles/stackoverflow-light.min.css`,dark:`${P}/highlight.js/11.8.0/styles/stackoverflow-dark.min.css`}},j={editorExtensions:{},editorConfig:{},codeMirrorExtensions:(e,t)=>t,markdownItConfig:()=>{},markdownItPlugins:e=>e,iconfontType:"svg",mermaidConfig:e=>e},ye=170,Z=({instance:e,ctx:t,props:l={}},o="default")=>{const i=(e==null?void 0:e.$slots[o])||(t==null?void 0:t.slots[o]);return(i?i(e):"")||l[o]},lo={overlay:{type:[String,Object],default:""},visible:{type:Boolean,default:!1},onChange:{type:Function,default:()=>{}},relative:{type:String,default:"html"}},ge=N({props:lo,setup(e,t){const l=`${c}-dropdown-hidden`,o=z({overlayClass:[l],overlayStyle:{},triggerHover:!1,overlayHover:!1}),i=B(),r=B(),u=()=>{var n;o.triggerHover=!0;const m=i.value,k=r.value;if(!m||!k)return;const $=m.getBoundingClientRect(),v=m.offsetTop,y=m.offsetLeft,f=$.height,h=$.width,b=((n=document.querySelector(e.relative))==null?void 0:n.scrollLeft)||0;o.overlayStyle={...o.overlayStyle,top:v+f+"px",left:y-k.offsetWidth/2+h/2-b+"px"},e.onChange(!0)},g=()=>{o.overlayHover=!0};S(()=>e.visible,n=>{n?o.overlayClass=o.overlayClass.filter(m=>m!==l):o.overlayClass.push(l)});let d=-1;const a=n=>{i.value===n.target?o.triggerHover=!1:o.overlayHover=!1,clearTimeout(d),d=window.setTimeout(()=>{!o.overlayHover&&!o.triggerHover&&e.onChange(!1)},10)};return R(()=>{i.value.addEventListener("mouseenter",u),i.value.addEventListener("mouseleave",a),r.value.addEventListener("mouseenter",g),r.value.addEventListener("mouseleave",a)}),pe(()=>{i.value.removeEventListener("mouseenter",u),i.value.removeEventListener("mouseleave",a),r.value.removeEventListener("mouseenter",g),r.value.removeEventListener("mouseleave",a)}),()=>{const n=Z({ctx:t}),m=Z({props:e,ctx:t},"overlay"),k=Re(n instanceof Array?n[0]:n,{ref:i}),$=s("div",{class:[`${c}-dropdown`,o.overlayClass],style:o.overlayStyle,ref:r},[s("div",{class:`${c}-dropdown-overlay`},[m instanceof Array?m[0]:m])]);return[k,$]}}}),oo={title:{type:String,default:""},visible:{type:Boolean},trigger:{type:[String,Object]},onChange:{type:Function},overlay:{type:[String,Object]},insert:{type:Function},language:{type:String},theme:{type:String},default:{type:[String,Object]}},Ce=N({name:"DropdownToolbar",props:oo,emits:["onChange"],setup(e,t){const l=I("editorId");return()=>{const o=Z({props:e,ctx:t},"trigger"),i=Z({props:e,ctx:t},"overlay"),r=Z({props:e,ctx:t});return s(ge,{relative:`#${l}-toolbar-wrapper`,visible:e.visible,onChange:u=>{e.onChange instanceof Function?e.onChange(u):t.emit("onChange",u)},overlay:i},{default:()=>[s("div",{class:`${c}-toolbar-item`,title:e.title||""},[o,r])]})}}});Ce.install=e=>(e.component(Ce.name,Ce),e);var no=Object.defineProperty,ao=(e,t,l)=>t in e?no(e,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):e[t]=l,io=(e,t,l)=>(ao(e,typeof t!="symbol"?t+"":t,l),l);class ro{constructor(){io(this,"pools",{})}remove(t,l,o){const r=this.pools[t]&&this.pools[t][l];r&&(this.pools[t][l]=r.filter(u=>u!==o))}clear(t){this.pools[t]={}}on(t,l){return this.pools[t]||(this.pools[t]={}),this.pools[t][l.name]||(this.pools[t][l.name]=[]),this.pools[t][l.name].push(l.callback),this.pools[t][l.name].includes(l.callback)}emit(t,l,...o){this.pools[t]||(this.pools[t]={});const r=this.pools[t][l];r&&r.forEach(u=>{try{u(...o)}catch(g){console.error(`${l} monitor event exception！`,g)}})}}const C=new ro,Ee="onSave",je="changeCatalogVisible",dl="changeFullscreen",Dt="pageFullscreenChanged",jt="fullscreenChanged",Ot="previewChanged",Vt="htmlPreviewChanged",Wt="catalogVisibleChanged",$e="buildFinished",se="errorCatcher",F="replace",Ie="uploadImage",Ne="openModals",ml="ctrlZ",gl="ctrlShiftZ",De="catalogChanged",fl="pushCatalog",Oe="rerender",vl="eventListener",so=(e,t="image.png")=>{const l=e.split(","),o=l[0].match(/:(.*?);/);if(o){const i=o[1],r=atob(l[1]);let u=r.length;const g=new Uint8Array(u);for(;u--;)g[u]=r.charCodeAt(u);return new File([g],t,{type:i})}return null},co=e=>{if(!e)return e;const t=e.split(`
`),l=['<span rn-wrapper aria-hidden="true">'];return t.forEach(()=>{l.push("<span></span>")}),l.push("</span>"),`<span class="code-block">${e}</span>${l.join("")}`},uo=(e,t)=>{if(!e||!t)return 0;const l=e==null?void 0:e.getBoundingClientRect();if(t===document.documentElement)return l.top-t.clientTop;const o=t==null?void 0:t.getBoundingClientRect();return l.top-o.top},mo=(()=>{let e=0;return t=>t+ ++e})(),zt=(e,t)=>{const l=o=>{const i=e.parentElement||document.body,r=i.offsetWidth,u=i.offsetHeight,{clientWidth:g}=document.documentElement,{clientHeight:d}=document.documentElement,a=o.offsetX,n=o.offsetY,m=$=>{let v=$.x+document.body.scrollLeft-document.body.clientLeft-a,y=$.y+document.body.scrollTop-document.body.clientTop-n;v=v<1?1:v<g-r-1?v:g-r-1,y=y<1?1:y<d-u-1?y:d-u-1,t?t(v,y):(i.style.left=`${v}px`,i.style.top=`${y}px`)};document.addEventListener("mousemove",m);const k=()=>{document.removeEventListener("mousemove",m),document.removeEventListener("mouseup",k)};document.addEventListener("mouseup",k)};return e.addEventListener("mousedown",l),()=>{e.removeEventListener("mousedown",l)}},K=(e,t="")=>{const l=document.getElementById(e.id),o=e.onload;e.onload=null;const i=function(r){typeof o=="function"&&o.bind(this)(r),e.removeEventListener("load",i)};l?t!==""&&(l.addEventListener("load",i),Reflect.get(window,t)&&l.dispatchEvent(new Event("load"))):(e.addEventListener("load",i),document.head.appendChild(e))},go=Se((e,t,l)=>{const o=document.getElementById(e);o&&o.setAttribute(t,l)},10),fo=N({props:{name:{type:String,default:""}},setup(e){return()=>j.iconfontType==="svg"?s("svg",{class:`${c}-icon`,"aria-hidden":"true"},[s("use",{"xlink:href":`#${c}-icon-${e.name}`},null)]):s("i",{class:`${c}-iconfont ${c}-icon-${e.name}`},null)}}),x=N({props:{name:{type:String,default:""}},setup(e){const t=I("customIcon");return()=>{const l=t.value[e.name];return typeof l=="object"?typeof l.component=="object"?El(l.component,l.props):s("span",{innerHTML:l.component},null):s(fo,{name:e.name},null)}}}),vo={title:{type:String,default:""},visible:{type:Boolean,default:!1},width:{type:String,default:"auto"},height:{type:String,default:"auto"},onClose:{type:Function},showAdjust:{type:Boolean,default:!1},isFullscreen:{type:Boolean,default:!1},onAdjust:{type:Function,default:()=>{}},class:{type:String},style:{type:Object,default:()=>({})}},Ut=(()=>{let e=2e4;return()=>++e})(),fe=N({name:"MdModal",props:vo,emits:["onClose"],setup(e,t){const l=I("theme"),o=B(e.visible),i=B([`${c}-modal`]),r=B(),u=B(),g=B(),d=re();let a=()=>{};const n=z({maskStyle:{zIndex:-1},modalStyle:{zIndex:-1},initPos:{left:"0px",top:"0px"},historyPos:{left:"0px",top:"0px"}}),m=G(()=>e.isFullscreen?{width:"100%",height:"100%"}:{width:e.width,height:e.height});return S(()=>e.isFullscreen,k=>{k?a():te(()=>{a=zt(u.value,($,v)=>{n.initPos.left=$+"px",n.initPos.top=v+"px"})})}),S(()=>e.visible,k=>{k?(n.maskStyle.zIndex=Ut(),n.modalStyle.zIndex=Ut(),i.value.push("zoom-in"),o.value=k,te(()=>{const $=r.value.offsetWidth/2,v=r.value.offsetHeight/2,y=document.documentElement.clientWidth/2,f=document.documentElement.clientHeight/2;n.initPos.left=y-$+"px",n.initPos.top=f-v+"px",e.isFullscreen||(a=zt(u.value,(h,b)=>{n.initPos.left=h+"px",n.initPos.top=b+"px"}))}),setTimeout(()=>{i.value=i.value.filter($=>$!=="zoom-in")},140)):(i.value.push("zoom-out"),a(),setTimeout(()=>{i.value=i.value.filter($=>$!=="zoom-out"),o.value=k},130))}),R(()=>{g.value=document.body}),()=>{const k=Z({ctx:t}),$=Z({props:e,ctx:t},"title");return g.value?s(xl,{to:g.value},{default:()=>[s("div",{ref:d,class:`${c}-modal-container`,"data-theme":l.value},[s("div",{class:e.class,style:{...e.style,display:o.value?"block":"none"}},[s("div",{class:`${c}-modal-mask`,style:n.maskStyle,onClick:()=>{e.onClose?e.onClose():t.emit("onClose")}},null),s("div",{class:i.value,style:{...n.modalStyle,...n.initPos,...m.value},ref:r},[s("div",{class:`${c}-modal-header`,ref:u},[$||""]),s("div",{class:`${c}-modal-body`},[k]),s("div",{class:`${c}-modal-func`},[e.showAdjust&&s("div",{class:`${c}-modal-adjust`,onClick:v=>{v.stopPropagation(),e.isFullscreen?n.initPos=n.historyPos:(n.historyPos=n.initPos,n.initPos={left:"0",top:"0"}),e.onAdjust(!e.isFullscreen)}},[s(x,{name:e.isFullscreen?"suoxiao":"fangda"},null)]),s("div",{class:`${c}-modal-close`,onClick:v=>{v.stopPropagation(),e.onClose?e.onClose():t.emit("onClose")}},[s(x,{name:"close"},null)])])])])])]}):""}}});fe.install=e=>(e.component(fe.name,fe),e);const ho=(e,t)=>{const l=I("editorId"),{noImgZoomIn:o}=e;let i=()=>{};S([t,ie(e.setting,"preview")],()=>{!o&&e.setting.preview&&i()},{immediate:!0}),R(()=>{i=Se(()=>{const r=document.querySelectorAll(`#${l}-preview img`);r.length!==0&&zl(r,{background:"#00000073"})})})},bo=(e,t)=>{if(typeof t[e]=="string")return t[e];const l=`<i class="${c}-iconfont ${c}-icon-${e}"></i>`;switch(j.iconfontType){case"svg":return`<svg class="${c}-icon" aria-hidden="true"><use xlink:href="#${c}-icon-${e}"></use></svg>`;default:return l}},po=(e,t,l)=>{const o=I("editorId"),i=I("usedLanguageText"),r=I("customIcon"),u=()=>{document.querySelectorAll(`#${o}-preview pre`).forEach(a=>{var n,m;let k=-1;(n=a.querySelector(".copy-button"))==null||n.remove();const $=((m=i.value.copyCode)==null?void 0:m.text)||"复制代码",v=document.createElement("span");v.setAttribute("class","copy-button"),v.dataset.tips=$,v.innerHTML=bo("copy",r.value),v.addEventListener("click",()=>{var y,f;clearTimeout(k);const h=a.querySelector("code").innerText,b=Ul(e.formatCopiedText(h)),T=((y=i.value.copyCode)==null?void 0:y.successTips)||"已复制！",_=((f=i.value.copyCode)==null?void 0:f.failTips)||"已复制！";v.dataset.tips=b?T:_,k=window.setTimeout(()=>{v.dataset.tips=$},1500)}),a.appendChild(v)})},g=()=>{te(u)},d=a=>{a&&te(u)};S([t,l],g),S(()=>e.setting.preview,d),S(()=>e.setting.htmlPreview,d),S(()=>i.value,u),R(u)},yo=e=>{var t;const l=(t=j.editorExtensions)==null?void 0:t.highlight,o=l==null?void 0:l.instance,i=I("highlight"),r=re(o);return R(()=>{if(!e.noHighlight&&!r.value){const u=document.createElement("script");u.src=i.value.js,u.onload=()=>{r.value=window.hljs},u.id=`${c}-hljs`,K(u,"hljs");const g=document.createElement("link");g.rel="stylesheet",g.href=i.value.css,g.id=`${c}-hlCss`,K(g)}}),S(()=>i.value.css,u=>{go(`${c}-hlCss`,"href",u)}),r},ko=e=>{const t=I("theme"),{editorExtensions:l,mermaidConfig:o}=j,i=l==null?void 0:l.mermaid,r=re(i==null?void 0:i.instance),u=re(-1),g=new Xl({max:1e3,ttl:6e5}),d=()=>{const n=r.value;!e.noMermaid&&n&&(n.initialize(o({startOnLoad:!1,theme:t.value==="dark"?"dark":"default"})),u.value=u.value+1)};return S(()=>t.value,()=>{g.clear(),d()}),R(()=>{if(!e.noMermaid&&!(i!=null&&i.instance)){const n=(i==null?void 0:i.js)||to;if(/\.mjs/.test(n))Ll(()=>import(n),[],import.meta.url).then(m=>{r.value=m.default,d()});else{const m=document.createElement("script");m.id=`${c}-mermaid`,m.src=n,m.onload=()=>{r.value=window.mermaid,d()},K(m,"mermaid")}}}),{mermaidRef:r,reRenderRef:u,replaceMermaid:()=>{te(()=>{if(!e.noMermaid&&r.value){const n=document.querySelectorAll(`div.${c}-mermaid`),m=document.createElement("div");m.style.width=document.body.offsetWidth+"px",m.style.height=document.body.offsetHeight+"px",m.style.position="fixed",m.style.zIndex="-10000",m.style.top="-10000";let k=n.length;k>0&&document.body.appendChild(m),n.forEach(async $=>{let v=g.get($.innerText);if(!v){const f=Be(),h=r.value.renderAsync||r.value.render;let b="";try{b=await h(f,$.innerText,m)}catch(T){}v=await e.sanitizeMermaid(typeof b=="string"?b:b.svg),g.set($.innerText,v)}const y=document.createElement("p");y.className=`${c}-mermaid`,y.setAttribute("data-processed",""),y.innerHTML=v,$.dataset.line!==void 0&&(y.dataset.line=$.dataset.line),$.replaceWith(y),--k===0&&m.remove()})}})}}},Co=e=>{var t;const l=(t=j.editorExtensions)==null?void 0:t.katex,o=l==null?void 0:l.instance,i=re(o);return R(()=>{if(!e.noKatex&&!i.value){const r=document.createElement("script");r.src=(l==null?void 0:l.js)||Rt.js,r.onload=()=>{i.value=window.katex},r.id=`${c}-katex`;const u=document.createElement("link");u.rel="stylesheet",u.href=(l==null?void 0:l.css)||Rt.css,u.id=`${c}-katexCss`,K(r,"katex"),K(u)}}),i},$o=(e,t)=>{const l=e.renderer.rules.fence.bind(e.renderer.rules);e.renderer.rules.fence=(o,i,r,u,g)=>{const d=o[i],a=d.content.trim();if(d.info==="mermaid"){let n;return o[i].map&&o[i].level===0&&(n=o[i].map[0],o[i].attrSet("data-line",String(n))),`<div class="${c}-mermaid" ${n!==void 0?"data-line="+n:""} data-mermaid-theme=${t.themeRef.value}>${a}</div>`}return l(o,i,r,u,g)}},wo=$o,Gt=(e,t)=>{let l=!0,o=!0;const i=e.posMax,r=t>0?e.src.charCodeAt(t-1):-1,u=t+1<=i?e.src.charCodeAt(t+1):-1;return(r===32||r===9||u>=48&&u<=57)&&(o=!1),(u===32||u===9)&&(l=!1),{can_open:l,can_close:o}},To=(e,t)=>{let l,o,i,r;if(e.src[e.pos]!=="$")return!1;if(i=Gt(e,e.pos),!i.can_open)return t||(e.pending+="$"),e.pos+=1,!0;const u=e.pos+1;for(l=u;(l=e.src.indexOf("$",l))!==-1;){for(r=l-1;e.src[r]==="\\";)r-=1;if((l-r)%2==1)break;l+=1}return l===-1?(t||(e.pending+="$"),e.pos=u,!0):l-u===0?(t||(e.pending+="$$"),e.pos=u+1,!0):(i=Gt(e,l),i.can_close?(t||(o=e.push("math_inline","math",0),o.markup="$",o.content=e.src.slice(u,l)),e.pos=l+1,!0):(t||(e.pending+="$"),e.pos=u,!0))},_o=(e,t,l,o)=>{let i,r,u,g,d=!1,a=e.bMarks[t]+e.tShift[t],n=e.eMarks[t];if(a+2>n||e.src.slice(a,a+2)!=="$$")return!1;if(a+=2,i=e.src.slice(a,n),o)return!0;for(i.trim().slice(-2)==="$$"&&(i=i.trim().slice(0,-2),d=!0),u=t;!d&&(u++,!(u>=l||(a=e.bMarks[u]+e.tShift[u],n=e.eMarks[u],a<n&&e.tShift[u]<e.blkIndent)));)e.src.slice(a,n).trim().slice(-2)==="$$"&&(g=e.src.slice(0,n).lastIndexOf("$$"),r=e.src.slice(a,g),d=!0);e.line=u+1;const m=e.push("math_block","math",0);return m.block=!0,m.content=(i&&i.trim()?i+`
`:"")+e.getLines(t+1,u,e.tShift[t],!0)+(r&&r.trim()?r:""),m.map=[t,e.line],m.markup="$$",!0},So=(e,t)=>{const l=i=>{if(t.katexRef.value){const r=t.katexRef.value.renderToString(i,{throwOnError:!1});return`<span class="${c}-katex-inline" data-processed>${r}</span>`}else return`<span class="${c}-katex-inline">${i}</span>`},o=(i,r)=>{if(t.katexRef.value){const u=t.katexRef.value.renderToString(i,{throwOnError:!1,displayMode:!0});return`<p class="${c}-katex-block" data-line=${r} data-processed>${u}</p>`}else return`<p class="${c}-katex-block" data-line=${r}>${i}</p>`};e.inline.ruler.after("escape","math_inline",To),e.block.ruler.after("blockquote","math_block",_o,{alt:["paragraph","reference","blockquote","list"]}),e.renderer.rules.math_inline=(i,r)=>l(i[r].content),e.renderer.rules.math_block=(i,r)=>o(i[r].content,i[r].map[0])+`
`},xo=So,Eo=(e,t)=>{t=t||{};const l=3,o=t.marker||"!",i=o.charCodeAt(0),r=o.length;let u="",g="";const d=(n,m,k,$,v)=>{const y=n[m];return y.type==="admonition_open"?(n[m].attrPush(["class",`${c}-admonition ${c}-admonition-${y.info}`]),n[m].attrSet("data-line",String(n[m].map[0]))):y.type==="admonition_title_open"&&n[m].attrPush(["class",`${c}-admonition-title`]),v.renderToken(n,m,k)},a=n=>{const m=n.trim().split(" ",2);g="",u=m[0],m.length>1&&(g=n.substring(u.length+2)),(g===""||!g)&&(g=u)};e.block.ruler.before("code","admonition",(n,m,k,$)=>{let v,y,f,h=!1,b=n.bMarks[m]+n.tShift[m],T=n.eMarks[m];if(i!==n.src.charCodeAt(b))return!1;for(v=b+1;v<=T&&o[(v-b)%r]===n.src[v];v++);const _=Math.floor((v-b)/r);if(_!==l)return!1;v-=(v-b)%r;const w=n.src.slice(b,v),L=n.src.slice(v,T);if(a(L),$)return!0;for(y=m;y++,!(y>=k||(b=n.bMarks[y]+n.tShift[y],T=n.eMarks[y],b<T&&n.sCount[y]<n.blkIndent));)if(i===n.src.charCodeAt(b)&&!(n.sCount[y]-n.blkIndent>=4)){for(v=b+1;v<=T&&o[(v-b)%r]===n.src[v];v++);if(!(Math.floor((v-b)/r)<_)&&(v-=(v-b)%r,v=n.skipSpaces(v),!(v<T))){h=!0;break}}const A=n.parentType,H=n.lineMax;return n.parentType="root",n.lineMax=y,f=n.push("admonition_open","div",1),f.markup=w,f.block=!0,f.info=u,f.map=[m,y],f=n.push("admonition_title_open","p",1),f.markup=w+" "+u,f.map=[m,y],f=n.push("inline","",0),f.content=g,f.map=[m,n.line-1],f.children=[],f=n.push("admonition_title_close","p",-1),f.markup=w+" "+u,n.md.block.tokenize(n,m+1,y),f=n.push("admonition_close","div",-1),f.markup=n.src.slice(b,v),f.block=!0,n.parentType=A,n.lineMax=H,n.line=y+(h?1:0),!0},{alt:["paragraph","reference","blockquote","list"]}),e.renderer.rules.admonition_open=d,e.renderer.rules.admonition_title_open=d,e.renderer.rules.admonition_title_close=d,e.renderer.rules.admonition_close=d},Io=Eo,Lo=(e,t)=>{e.renderer.rules.heading_open=(l,o)=>{var i;const r=l[o],u=((i=l[o+1].children)==null?void 0:i.reduce((d,a)=>d+(a.content||""),""))||"",g=r.markup.length;return t.headsRef.value.push({text:u,level:g}),r.map&&r.level===0&&(r.attrSet("data-line",String(r.map[0])),r.attrSet("id",t.mdHeadingId(u,g,t.headsRef.value.length))),e.renderer.renderToken(l,o,t)},e.renderer.rules.heading_close=(l,o,i,r,u)=>u.renderToken(l,o,i)},Ho=Lo,Ao=(e,t)=>{const l=e.renderer.rules.fence,o=e.utils.unescapeAll,i=/\[(\w*)(?::([\w ]*))?\]/;function r(a){return a.info?o(a.info).trim():""}function u(a){const n=r(a),[m=null,k=""]=(i.exec(n)||[]).slice(1);return[m,k]}function g(a){const n=r(a);return n?n.split(/(\s+)/g)[0]:""}const d=(a,n,m,k,$)=>{if(a[n].hidden)return"";const[v,y]=u(a[n]);if(v===null)return l(a,n,m,k,$);let f,h,b,T,_="",w="";for(let L=n;L<a.length&&(f=a[L],[h,b]=u(f),h===v);L++)f.info=f.info.replace(i,""),f.hidden=!0,T=L-n>0?"":" checked",_+=`<li><input type="radio" name="label-group-${t.editorId}-${n}"${T}><label for="group-${t.editorId}-${n}-tab-${L-n}" onclick="this.previousElementSibling.click()">${b||g(f)}</label></li>
`,w+=`<input type="radio" id="group-${t.editorId}-${n}-tab-${L-n}" name="group-${t.editorId}-${n}"${T}>
`+l(a,L,m,k,$);return`<div class="code-tabs">
<ul>
`+_+`</ul>
`+w+"</div>"};e.renderer.rules.fence=d},Mo=Ao,Fo=e=>{["paragraph_open","table_open","ordered_list_open","bullet_list_open","blockquote_open","hr","html_block","fence"].forEach(t=>{const l=e.renderer.rules[t];l?e.renderer.rules[t]=(o,i,r,u,g)=>{let d;const a=l(o,i,r,u,g);return o[i].map&&o[i].level===0&&!/^<!--/.test(a)?(d=o[i].map[0],a.replace(/^(<[^>]*)/,`$1 data-line="${d}"`)):a}:e.renderer.rules[t]=(o,i,r,u,g)=>{let d;return o[i].map&&o[i].level===0&&(d=o[i].map[0],o[i].attrSet("data-line",String(d))),g.renderToken(o,i,r)}})},Po=(e,t)=>{const{editorConfig:l,markdownItConfig:o,markdownItPlugins:i}=j,r=I("editorId"),u=I("showCodeRowNumber"),g=I("theme"),d=B([]),a=yo(e),n=Co(e),{reRenderRef:m,replaceMermaid:k}=ko(e),$=Gl({html:!0,breaks:!0});o($,{editorId:r});const v=[{type:"katex",plugin:xo,options:{katexRef:n}},{type:"image",plugin:ql,options:{figcaption:!0,classes:"md-zoom"}},{type:"admonition",plugin:Io,options:{}},{type:"taskList",plugin:Kl,options:{}},{type:"heading",plugin:Ho,options:{mdHeadingId:e.mdHeadingId,headsRef:d}},{type:"codeTabs",plugin:Mo,options:{editorId:r}},{type:"xss",plugin:Zl,options:{xss(w){return{whiteList:Object.assign({},w.getDefaultWhiteList(),{input:["class","disabled","type","checked"],iframe:["class","width","height","src","title","border","frameborder","framespacing","allow","allowfullscreen"]})}}}}];e.noMermaid||v.push({type:"mermaid",plugin:wo,options:{themeRef:g}}),i(v,{editorId:r}).forEach(w=>{$.use(w.plugin,w.options)});const y=$.options.highlight;$.set({highlight:(w,L,A)=>{if(y){const M=y(w,L,A);if(M)return M}let H;!e.noHighlight&&a.value?a.value.getLanguage(L)?H=a.value.highlight(w,{language:L,ignoreIllegals:!0}).value:H=a.value.highlightAuto(w).value:H=$.utils.escapeHtml(w);const D=u?co(H.replace(/^\n+|\n+$/g,"")):`<span class="code-block">${H.replace(/^\n+|\n+$/g,"")}</span>`;return`<pre><code class="language-${L}" language=${L}>${D}</code></pre>`}}),Fo($);const f=B(`_article-key_${Be()}`),h=B(e.sanitize($.render(e.modelValue))),b=()=>{C.emit(r,$e,h.value),e.onHtmlChanged(h.value),e.onGetCatalog(d.value),C.emit(r,De,d.value),k()};R(b);const T=()=>{d.value=[],h.value=e.sanitize($.render(e.modelValue)),b()},_=G(()=>(e.noKatex||n.value)&&(e.noHighlight||a.value));return S([ie(e,"modelValue"),_,m],Se(T,(l==null?void 0:l.renderDelay)!==void 0?l==null?void 0:l.renderDelay:t?0:500)),R(()=>{C.on(r,{name:fl,callback(){C.emit(r,De,d.value)}}),C.on(r,{name:Oe,callback:()=>{T(),f.value=`_article-key_${Be()}`}})}),{html:h,key:f}},Bo=Po,hl={modelValue:{type:String,default:""},setting:{type:Object,default:()=>({preview:!0})},onHtmlChanged:{type:Function,default:()=>{}},onGetCatalog:{type:Function,default:()=>{}},mdHeadingId:{type:Function,default:()=>""},noMermaid:{type:Boolean,default:!1},sanitize:{type:Function,default:e=>e},noKatex:{type:Boolean,default:!1},formatCopiedText:{type:Function,default:e=>e},noHighlight:{type:Boolean,default:!1},previewOnly:{type:Boolean,default:!1},noImgZoomIn:{type:Boolean},sanitizeMermaid:{type:Function}},Ro={...hl,updateModelValue:{type:Function,default:()=>{}},onChange:{type:Function,default:()=>{}},placeholder:{type:String,default:""},scrollAuto:{type:Boolean},autofocus:{type:Boolean},disabled:{type:Boolean},readonly:{type:Boolean},maxlength:{type:Number},autoDetectCode:{type:Boolean},onBlur:{type:Function,default:()=>{}},onFocus:{type:Function,default:()=>{}},noPrettier:{type:Boolean},completions:{type:Array},catalogVisible:{type:Boolean},theme:{type:String,default:"light"},onInput:{type:Function},onDrop:{type:Function,default:()=>{}},inputBoxWitdh:{type:String},onInputBoxWitdhChange:{type:Function}},bl=N({name:"ContentPreview",props:hl,setup(e){const t=I("editorId"),l=I("previewTheme"),o=I("showCodeRowNumber"),{html:i,key:r}=Bo(e,e.previewOnly);return po(e,i,r),ho(e,i),()=>s(xe,null,[e.setting.preview&&s("div",{id:`${t}-preview-wrapper`,class:`${c}-preview-wrapper`,key:"content-preview-wrapper"},[s("div",{key:r.value,id:`${t}-preview`,class:[`${c}-preview`,`${l==null?void 0:l.value}-theme`,o&&`${c}-scrn`],innerHTML:i.value},null)]),!e.previewOnly&&e.setting.htmlPreview&&s("div",{id:`${t}-html-wrapper`,class:`${c}-preview-wrapper`,key:"html-preview-wrapper"},[s("div",{class:`${c}-html`},[i.value])])])}}),No=(e,t)=>{const{editorId:l}=e,o=z({buildFinished:!1,html:""});S(()=>e.modelValue,()=>{o.buildFinished=!1}),R(()=>{C.on(l,{name:$e,callback(i){o.buildFinished=!0,o.html=i}}),C.on(l,{name:Ee,callback(){const i=new Promise(r=>{if(o.buildFinished)r(o.html);else{const u=g=>{r(g),C.remove(l,$e,u)};C.on(l,{name:$e,callback:u})}});e.onSave?e.onSave(e.modelValue,i):t.emit("onSave",e.modelValue,i)}})})},pl=e=>{var t,l;const{editorId:o}=e,i=(l=(t=j)==null?void 0:t.editorExtensions)==null?void 0:l.highlight;Q("editorId",o),Q("theme",G(()=>e.theme)),Q("language",G(()=>e.language)),Q("highlight",G(()=>{const u={...Nt,...i==null?void 0:i.css},g=e.codeStyleReverse&&e.codeStyleReverseList.includes(e.previewTheme)?"dark":e.theme;return{js:(i==null?void 0:i.js)||Ql,css:u[e.codeTheme]?u[e.codeTheme][g]:Nt.atom[g]}})),Q("showCodeRowNumber",e.showCodeRowNumber);const r=G(()=>{var u,g;const d={...Bt,...(g=(u=j)==null?void 0:u.editorConfig)==null?void 0:g.languageUserDefined};return d[e.language]?d[e.language]:Bt["zh-CN"]});Q("usedLanguageText",r),Q("previewTheme",G(()=>e.previewTheme)),Q("customIcon",G(()=>e.customIcon))},Do=e=>{pl(e),Q("tabWidth",e.tabWidth)},yl=e=>{R(()=>{var t,l;if(!e.noIconfont)if(j.iconfontType==="svg"){const o=document.createElement("script");o.src=((t=j.editorExtensions)==null?void 0:t.iconfont)||Jl,o.id=`${c}-icon`,K(o)}else{const o=document.createElement("link");o.rel="stylesheet",o.href=((l=j.editorExtensions)==null?void 0:l.iconfontClass)||Yl,o.id=`${c}-icon-class`,K(o)}})},jo=e=>{var t,l,o,i,r,u;const{noPrettier:g,noUploadImg:d}=e,{editorExtensions:a}=j,n=g||!!((l=(t=j.editorExtensions)==null?void 0:t.prettier)!=null&&l.prettierInstance),m=g||!!((i=(o=j.editorExtensions)==null?void 0:o.prettier)!=null&&i.parserMarkdownInstance),k=d||!!((u=(r=j.editorExtensions)==null?void 0:r.cropper)!=null&&u.instance);R(()=>{var $,v,y,f;const h=document.createElement("script"),b=document.createElement("script");h.src=(($=a==null?void 0:a.prettier)==null?void 0:$.standaloneJs)||Ft.main,h.id=`${c}-prettier`,b.src=((v=a==null?void 0:a.prettier)==null?void 0:v.parserMarkdownJs)||Ft.markdown,b.id=`${c}-prettierMD`;const T=document.createElement("link");T.rel="stylesheet",T.href=((y=a==null?void 0:a.cropper)==null?void 0:y.css)||Pt.css,T.id=`${c}-cropperCss`;const _=document.createElement("script");_.src=((f=a==null?void 0:a.cropper)==null?void 0:f.js)||Pt.js,_.id=`${c}-cropper`,k||(K(T),K(_)),n||K(h),m||K(b)}),yl(e)},Oo=(e,t)=>{const{editorId:l}=e;R(()=>{C.on(l,{name:se,callback:o=>{e.onError instanceof Function?e.onError(o):t.emit("onError",o)}})})},Vo=(e,t)=>{const{editorId:l}=e,o=z({pageFullscreen:e.pageFullscreen,fullscreen:!1,preview:e.preview,htmlPreview:e.preview?!1:e.htmlPreview}),i=(g,d)=>{o[g]=d===void 0?!o[g]:d,g==="preview"&&o.preview?o.htmlPreview=!1:g==="htmlPreview"&&o.htmlPreview&&(o.preview=!1)};let r="";const u=()=>{o.pageFullscreen||o.fullscreen?document.body.style.overflow="hidden":document.body.style.overflow=r};return S(()=>[o.pageFullscreen,o.fullscreen],u),R(()=>{C.on(l,{name:Ie,callback(g,d){const a=n=>{C.emit(l,F,"image",{desc:"",urls:n}),d&&d()};e.onUploadImg?e.onUploadImg(g,a):t.emit("onUploadImg",g,a)}}),r=document.body.style.overflow,u()}),[o,i]},Wo=e=>{const{editorId:t}=e,l=B(!1);return R(()=>{C.on(t,{name:je,callback:i=>{i===void 0?l.value=!l.value:l.value=i}})}),G(()=>!e.toolbarsExclude.includes("catalog")&&e.toolbars.includes("catalog")&&l.value)},zo=(e,t,l,o,i,r)=>{const{editorId:u}=e;S(()=>o.pageFullscreen,d=>{C.emit(u,Dt,d)}),S(()=>o.fullscreen,d=>{C.emit(u,jt,d)}),S(()=>o.preview,d=>{C.emit(u,Ot,d)}),S(()=>o.htmlPreview,d=>{C.emit(u,Vt,d)}),S(l,d=>{C.emit(u,Wt,d)});const g={on(d,a){switch(d){case"pageFullscreen":{C.on(u,{name:Dt,callback(n){a(n)}});break}case"fullscreen":{C.on(u,{name:jt,callback(n){a(n)}});break}case"preview":{C.on(u,{name:Ot,callback(n){a(n)}});break}case"htmlPreview":{C.on(u,{name:Vt,callback(n){a(n)}});break}case"catalog":{C.on(u,{name:Wt,callback(n){a(n)}});break}}},togglePageFullscreen(d){i("pageFullscreen",d)},toggleFullscreen(d){C.emit(u,dl,d)},togglePreview(d){i("preview",d)},toggleHtmlPreview(d){i("htmlPreview",d)},toggleCatalog(d){C.emit(u,je,d)},triggerSave(){C.emit(u,Ee)},insert(d){C.emit(u,F,"universal",{generate:d})},focus(d){var a;(a=r.value)==null||a.focus(d)},rerender(){C.emit(u,Oe)},getSelectedText(){var d;return(d=r.value)==null?void 0:d.getSelectedText()},resetHistory(){var d;(d=r.value)==null||d.resetHistory()},domEventHandlers(d){C.emit(u,vl,d)}};t.expose(g)},Uo=e=>e,kl={modelValue:{type:String,default:""},theme:{type:String,default:"light"},class:{type:String,default:""},language:{type:String,default:"zh-CN"},onHtmlChanged:{type:Function},onGetCatalog:{type:Function},editorId:{type:String,default:()=>mo("md-editor-v3_")},showCodeRowNumber:{type:Boolean,default:!1},previewTheme:{type:String,default:"default"},style:{type:Object,default:()=>({})},mdHeadingId:{type:Function,default:Uo},sanitize:{type:Function,default:e=>e},noMermaid:{type:Boolean,default:!1},noKatex:{type:Boolean,default:!1},codeTheme:{type:String,default:"atom"},noIconfont:{type:Boolean},formatCopiedText:{type:Function,default:e=>e},codeStyleReverse:{type:Boolean,default:!0},codeStyleReverseList:{type:Array,default:["default","mk-cute"]},noHighlight:{type:Boolean,default:!1},noImgZoomIn:{type:Boolean,default:!1},customIcon:{type:Object,default:{}},sanitizeMermaid:{type:Function,default:e=>Promise.resolve(e)}},Go={...kl,onChange:{type:Function},onSave:{type:Function},onUploadImg:{type:Function},pageFullscreen:{type:Boolean,default:!1},preview:{type:Boolean,default:!0},htmlPreview:{type:Boolean,default:!1},toolbars:{type:Array,default:cl},toolbarsExclude:{type:Array,default:[]},noPrettier:{type:Boolean,default:!1},tabWidth:{type:Number,default:2},tableShape:{type:Array,default:()=>[6,4]},placeholder:{type:String,default:""},defToolbars:{type:[String,Object]},onError:{type:Function},footers:{type:Array,default:ul},scrollAuto:{type:Boolean,default:!0},defFooters:{type:[String,Object]},noUploadImg:{type:Boolean},autoFocus:{type:Boolean},disabled:{type:Boolean},readOnly:{type:Boolean},maxLength:{type:Number},autoDetectCode:{type:Boolean},onBlur:{type:Function},onFocus:{type:Function},completions:{type:Array},showToolbarName:{type:Boolean,default:!1},onInput:{type:Function},onDrop:{type:Function},inputBoxWitdh:{type:String,default:"50%"},onInputBoxWitdhChange:{type:Function}},Cl=["onHtmlChanged","onGetCatalog"],qo=[...Cl,"onChange","onSave","onUploadImg","onError","update:modelValue","onBlur","onFocus","onInput","onDrop","onInputBoxWitdhChange"],Ko=(e,t)=>{const{editorId:l}=e,o={rerender(){C.emit(l,Oe)}};t.expose(o)},we=N({name:"MdPreview",props:kl,emits:Cl,setup(e,t){const{editorId:l,noKatex:o,noMermaid:i,noHighlight:r}=e;return pl(e),yl(e),Ko(e,t),pe(()=>{C.clear(l)}),()=>s("div",{id:l,class:[c,e.class,e.theme==="dark"&&`${c}-dark`,`${c}-previewOnly`],style:e.style},[s(bl,{modelValue:e.modelValue,onHtmlChanged:u=>{e.onHtmlChanged?e.onHtmlChanged(u):t.emit("onHtmlChanged",u)},onGetCatalog:u=>{e.onGetCatalog?e.onGetCatalog(u):t.emit("onGetCatalog",u)},mdHeadingId:e.mdHeadingId,noMermaid:i,sanitize:e.sanitize,noKatex:o,formatCopiedText:e.formatCopiedText,noHighlight:r,noImgZoomIn:e.noImgZoomIn,previewOnly:!0,sanitizeMermaid:e.sanitizeMermaid},null)])}});we.install=e=>(e.component(we.name,we),e);const Zo={tocItem:{type:Object,default:()=>({})},mdHeadingId:{type:Function,default:()=>{}},scrollElement:{type:[String,Object],default:""},onClick:{type:Function,default:()=>{}},scrollElementOffsetTop:{type:Number,default:0}},$l=N({props:Zo,setup(e){return()=>{const{tocItem:t,mdHeadingId:l,scrollElement:o,onClick:i,scrollElementOffsetTop:r}=e;return s("div",{class:[`${c}-catalog-link`,t.active&&`${c}-catalog-active`],onClick:u=>{i(u,t),u.stopPropagation();const g=l(t.text,t.level,t.index),d=document.getElementById(g),a=o instanceof Element?o:document.querySelector(o);if(d&&a){let n=d.offsetParent,m=d.offsetTop;if(a.contains(n))for(;n&&a!=n;)m+=n==null?void 0:n.offsetTop,n=n==null?void 0:n.offsetParent;a==null||a.scrollTo({top:m-r,behavior:"smooth"})}}},[s("span",{title:t.text},[t.text]),s("div",{class:`${c}-catalog-wrapper`},[t.children&&t.children.map(u=>s($l,{mdHeadingId:l,key:`${t.text}-link-${u.level}-${u.text}`,tocItem:u,scrollElement:o,onClick:i,scrollElementOffsetTop:r},null))])])}}}),Xo=$l,Jo={editorId:{type:String},class:{type:String,default:""},mdHeadingId:{type:Function,default:e=>e},scrollElement:{type:[String,Object]},theme:{type:String,default:"light"},offsetTop:{type:Number,default:20},scrollElementOffsetTop:{type:Number,default:0},onClick:{type:Function},onActive:{type:Function}},be=N({name:"MdCatalog",props:Jo,emits:["onClick","onActive"],setup(e,t){const l=e.editorId,o=z({list:[],show:!1,scrollElement:e.scrollElement||`#${l}-preview-wrapper`}),i=re(),r=G(()=>{const a=[];return o.list.forEach((n,m)=>{const{text:k,level:$}=n,v={level:$,text:k,index:m+1,active:i.value===n};if(a.length===0)a.push(v);else{let y=a[a.length-1];if(v.level>y.level)for(let f=y.level+1;f<=6;f++){const{children:h}=y;if(!h){y.children=[v];break}if(y=h[h.length-1],v.level<=y.level){h.push(v);break}}else a.push(v)}}),a}),u=()=>o.scrollElement instanceof HTMLElement?o.scrollElement:document.querySelector(o.scrollElement),g=a=>{if(a.length===0)return o.list=[],!1;const{activeHead:n}=a.reduce((m,k,$)=>{const v=document.getElementById(e.mdHeadingId(k.text,k.level,$+1));if(v instanceof HTMLElement){const y=u(),f=uo(v,y);if(f<e.offsetTop&&f>m.minTop)return{activeHead:k,minTop:f}}return m},{activeHead:a[0],minTop:Number.MIN_SAFE_INTEGER});i.value=n,o.list=a},d=()=>{g(o.list)};return S(()=>i.value,a=>{const n=a?{...a}:void 0;e.onActive?e.onActive(n):t.emit("onActive",n)}),R(()=>{const a=u(),n=a===document.documentElement?window:a;n==null||n.addEventListener("scroll",d),C.on(l,{name:De,callback:m=>{n==null||n.removeEventListener("scroll",d),g(m),n==null||n.addEventListener("scroll",d)}}),C.emit(l,fl)}),pe(()=>{var a;const n=u();(a=n===document.documentElement?window:n)==null||a.removeEventListener("scroll",d)}),()=>s("div",{class:`${c}-catalog${e.theme==="dark"?"-dark":""} ${e.class}`},[r.value.map(a=>s(Xo,{mdHeadingId:e.mdHeadingId,tocItem:a,key:`link-${a.level}-${a.text}`,scrollElement:o.scrollElement,onClick:(n,m)=>{e.onClick?e.onClick(n,m):t.emit("onClick",n,m)},scrollElementOffsetTop:e.scrollElementOffsetTop},null))])}});be.install=e=>(e.component(be.name,be),e);const Yo={title:{type:String,default:""},trigger:{type:[String,Object]},onClick:{type:Function},insert:{type:Function},language:{type:String},theme:{type:String}},Te=N({name:"NormalToolbar",props:Yo,emits:["onClick"],setup(e,t){return()=>{const l=Z({props:e,ctx:t},"trigger");return s("div",{class:`${c}-toolbar-item`,title:e.title,onClick:o=>{e.onClick instanceof Function?e.onClick(o):t.emit("onClick",o)}},[l])}}});Te.install=e=>(e.component(Te.name,Te),e);function Qo(e){return typeof e=="function"||Object.prototype.toString.call(e)==="[object Object]"&&!Il(e)}const en={title:{type:String,default:""},modalTitle:{type:String,default:""},visible:{type:Boolean},width:{type:String,default:"auto"},height:{type:String,default:"auto"},trigger:{type:[String,Object]},onClick:{type:Function},onClose:{type:Function},showAdjust:{type:Boolean,default:!1},isFullscreen:{type:Boolean,default:!1},onAdjust:{type:Function},insert:{type:Function},language:{type:String},theme:{type:String}},_e=N({name:"ModalToolbar",props:en,emits:["onClick","onClose","onAdjust"],setup(e,t){return()=>{const l=Z({props:e,ctx:t},"trigger"),o=Z({props:e,ctx:t},"default");return s(xe,null,[s("div",{class:`${c}-toolbar-item`,title:e.title,onClick:()=>{e.onClick instanceof Function?e.onClick():t.emit("onClick")}},[l]),s(fe,{width:e.width,height:e.height,title:e.modalTitle,visible:e.visible,onClose:()=>{e.onClose instanceof Function?e.onClose():t.emit("onClose")},showAdjust:e.showAdjust,isFullscreen:e.isFullscreen,onAdjust:i=>{e.onAdjust instanceof Function?e.onAdjust(i):t.emit("onAdjust",i)}},Qo(o)?o:{default:()=>[o]})])}}});_e.install=e=>(e.component(_e.name,_e),e);var tn=Object.defineProperty,ln=(e,t,l)=>t in e?tn(e,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):e[t]=l,ne=(e,t,l)=>(ln(e,typeof t!="symbol"?t+"":t,l),l);const on=N({setup(){return()=>s("div",{class:`${c}-divider`},null)}}),nn={noPrettier:{type:Boolean},toolbars:{type:Array,default:()=>[]},toolbarsExclude:{type:Array,default:()=>[]},setting:{type:Object,default:()=>({})},screenfull:{type:Object,default:null},screenfullJs:{type:String,default:""},updateSetting:{type:Function,default:()=>{}},tableShape:{type:Array,default:()=>[6,4]},defToolbars:{type:Object},noUploadImg:{type:Boolean},showToolbarName:{type:Boolean}},an=e=>{var t,l,o,i;const r=I("editorId");let u=(l=(t=j.editorExtensions)==null?void 0:t.screenfull)==null?void 0:l.instance;const g=(i=(o=j.editorExtensions)==null?void 0:o.screenfull)==null?void 0:i.js,d=B(!1),a=k=>{if(!u){C.emit(r,se,{name:"fullscreen",message:"fullscreen is undefined"});return}u.isEnabled?(d.value=!0,(k===void 0?!u.isFullscreen:k)?u.request():u.exit()):console.error("browser does not support screenfull!")},n=()=>{u&&u.isEnabled&&u.on("change",()=>{(d.value||e.setting.fullscreen)&&(d.value=!1,e.updateSetting("fullscreen"))})},m=()=>{u=window.screenfull,n()};return R(()=>{if(n(),!u){const k=document.createElement("script");k.src=g||eo,k.onload=m,k.id=`${c}-screenfull`,K(k,"screenfull")}}),R(()=>{C.on(r,{name:dl,callback:a})}),{fullscreenHandler:a}},rn={tableShape:{type:Array,default:()=>[6,4]},onSelected:{type:Function,default:()=>{}}},sn=N({name:"TableShape",props:rn,setup(e){const t=z({x:-1,y:-1});return()=>s("div",{class:`${c}-table-shape`,onMouseleave:()=>{t.x=-1,t.y=-1}},[new Array(e.tableShape[1]).fill("").map((l,o)=>s("div",{class:`${c}-table-shape-row`,key:`table-shape-row-${o}`},[new Array(e.tableShape[0]).fill("").map((i,r)=>s("div",{class:`${c}-table-shape-col`,key:`table-shape-col-${r}`,onMouseenter:()=>{t.x=o,t.y=r},onClick:()=>{e.onSelected(t)}},[s("div",{class:[`${c}-table-shape-col-default`,o<=t.x&&r<=t.y&&`${c}-table-shape-col-include`]},null)]))]))])}}),cn=sn,un={type:{type:String,default:"link"},visible:{type:Boolean,default:!1},onCancel:{type:Function,default:()=>{}},onOk:{type:Function,default:()=>{}}},dn=N({props:un,setup(e){const t=I("usedLanguageText"),l=I("editorId"),o=G(()=>{var r,u;switch(e.type){case"link":return(r=t.value.linkModalTips)==null?void 0:r.linkTitle;case"image":return(u=t.value.linkModalTips)==null?void 0:u.imageTitle;default:return""}}),i=z({desc:"",url:""});return S(()=>e.visible,r=>{r||setTimeout(()=>{i.desc="",i.url=""},200)}),()=>s(fe,{title:o.value,visible:e.visible,onClose:e.onCancel},{default:()=>{var r,u,g,d,a;return[s("div",{class:`${c}-form-item`},[s("label",{class:`${c}-label`,for:`link-desc-${l}`},[(r=t.value.linkModalTips)==null?void 0:r.descLabel]),s("input",{placeholder:(u=t.value.linkModalTips)==null?void 0:u.descLabelPlaceHolder,class:`${c}-input`,id:`link-desc-${l}`,type:"text",value:i.desc,onChange:n=>{i.desc=n.target.value},autocomplete:"off"},null)]),s("div",{class:`${c}-form-item`},[s("label",{class:`${c}-label`,for:`link-url-${l}`},[(g=t.value.linkModalTips)==null?void 0:g.urlLabel]),s("input",{placeholder:(d=t.value.linkModalTips)==null?void 0:d.urlLabelPlaceHolder,class:`${c}-input`,id:`link-url-${l}`,type:"text",value:i.url,onChange:n=>{i.url=n.target.value},autocomplete:"off"},null)]),s("div",{class:`${c}-form-item`},[s("button",{class:[`${c}-btn`,`${c}-btn-row`],type:"button",onClick:()=>{e.onOk(i),i.desc="",i.url=""}},[(a=t.value.linkModalTips)==null?void 0:a.buttonOK])])]}})}}),mn={visible:{type:Boolean,default:!1},onCancel:{type:Function,default:()=>{}},onOk:{type:Function,default:()=>{}}},gn=N({props:mn,setup(e){var t,l,o;const i=I("usedLanguageText"),r=I("editorId");let u=(o=(l=(t=j)==null?void 0:t.editorExtensions)==null?void 0:l.cropper)==null?void 0:o.instance;const g=B(),d=B(),a=B(),n=z({cropperInited:!1,imgSelected:!1,imgSrc:"",isFullscreen:!1});let m=null;S(()=>e.visible,()=>{e.visible&&!n.cropperInited&&(u=u||window.Cropper,g.value.onchange=()=>{if(!u){C.emit(r,se,{name:"Cropper",message:"Cropper is undefined"});return}const $=g.value.files||[];if(n.imgSelected=!0,($==null?void 0:$.length)>0){const v=new FileReader;v.onload=y=>{n.imgSrc=y.target.result,te(()=>{m=new u(d.value,{viewMode:2,preview:`.${c}-clip-preview-target`})})},v.readAsDataURL($[0])}})}),S(()=>[n.imgSelected],()=>{a.value.style=""}),S(()=>n.isFullscreen,()=>{te(()=>{m==null||m.destroy(),a.value.style="",d.value&&(m=new u(d.value,{viewMode:2,preview:`.${c}-clip-preview-target`}))})});const k=()=>{m.clear(),m.destroy(),m=null,g.value.value="",n.imgSelected=!1};return()=>{var $;return s(fe,{class:`${c}-modal-clip`,title:($=i.value.clipModalTips)==null?void 0:$.title,visible:e.visible,onClose:e.onCancel,showAdjust:!0,isFullscreen:n.isFullscreen,onAdjust:v=>{n.isFullscreen=v},width:"668px",height:"421px"},{default:()=>{var v,y;return[s("div",{class:`${c}-form-item ${c}-clip`},[s("div",{class:`${c}-clip-main`},[n.imgSelected?s("div",{class:`${c}-clip-cropper`},[s("img",{src:n.imgSrc,ref:d,style:{display:"none"},alt:""},null),s("div",{class:`${c}-clip-delete`,onClick:k},[s(x,{name:"delete"},null)])]):s("div",{class:`${c}-clip-upload`,onClick:()=>{g.value.click()}},[s(x,{name:"upload"},null)])]),s("div",{class:`${c}-clip-preview`},[s("div",{class:`${c}-clip-preview-target`,ref:a},null)])]),s("div",{class:`${c}-form-item`},[s("button",{class:`${c}-btn`,type:"button",onClick:()=>{if(m){const f=m.getCroppedCanvas();C.emit(r,Ie,[so(f.toDataURL("image/png"))],e.onOk),k()}}},[((v=i.value.clipModalTips)==null?void 0:v.buttonUpload)||((y=i.value.linkModalTips)==null?void 0:y.buttonOK)])]),s("input",{ref:g,accept:"image/*",type:"file",multiple:!1,style:{display:"none"}},null)]}})}}}),fn={type:{type:String,default:"link"},linkVisible:{type:Boolean,default:!1},clipVisible:{type:Boolean,default:!1},onCancel:{type:Function,default:()=>{}},onOk:{type:Function,default:()=>{}}},vn=N({props:fn,setup(e){return()=>s(xe,null,[s(dn,{type:e.type,visible:e.linkVisible,onOk:e.onOk,onCancel:e.onCancel},null),s(gn,{visible:e.clipVisible,onOk:e.onOk,onCancel:e.onCancel},null)])}}),hn=N({name:"MDEditorToolbar",props:nn,setup(e){const t=I("editorId"),l=I("usedLanguageText"),o=I("theme"),i=I("language"),{fullscreenHandler:r}=an(e),u=`${t}-toolbar-wrapper`,g=B(),d=z({title:!1,catalog:!1,image:!1,table:!1,mermaid:!1,katex:!1}),a=(f,h)=>{C.emit(t,F,f,h)},n=z({type:"link",linkVisible:!1,clipVisible:!1}),m=B();R(()=>{C.on(t,{name:Ne,callback(f){n.type=f,n.linkVisible=!0}})});const k=G(()=>{const f=e.toolbars.filter(_=>!e.toolbarsExclude.includes(_)),h=f.indexOf("="),b=h===-1?f:f.slice(0,h+1),T=h===-1?[]:f.slice(h,Number.MAX_SAFE_INTEGER);return[b,T]}),$=B(),v=()=>{C.emit(t,Ie,Array.from($.value.files||[])),$.value.value=""};R(()=>{$.value.addEventListener("change",v)});const y=f=>{var h,b,T,_,w,L,A,H,D,M,X,q,U,J,ce,ue,Y,le,oe,W,O,Le,Ve,We,ze,Ue,Ge,qe,Ke,Ze,Xe,Je,Ye,Qe,et,tt,lt,ot,nt,at,it,rt,st,ct,ut,dt,mt,gt,ft,vt,ht,bt,pt,yt,kt,Ct,$t,wt,Tt,_t,St,xt,Et,It,Lt,Ht,At;if(cl.includes(f))switch(f){case"-":return s(on,null,null);case"bold":return s("div",{class:`${c}-toolbar-item`,title:(h=l.value.toolbarTips)==null?void 0:h.bold,onClick:()=>{a("bold")}},[s(x,{name:"bold"},null),e.showToolbarName&&s("div",{class:`${c}-toolbar-item-name`},[(b=l.value.toolbarTips)==null?void 0:b.bold])]);case"underline":return s("div",{class:`${c}-toolbar-item`,title:(T=l.value.toolbarTips)==null?void 0:T.underline,onClick:()=>{a("underline")}},[s(x,{name:"underline"},null),e.showToolbarName&&s("div",{class:`${c}-toolbar-item-name`},[(_=l.value.toolbarTips)==null?void 0:_.underline])]);case"italic":return s("div",{class:`${c}-toolbar-item`,title:(w=l.value.toolbarTips)==null?void 0:w.italic,onClick:()=>{a("italic")}},[s(x,{name:"italic"},null),e.showToolbarName&&s("div",{class:`${c}-toolbar-item-name`},[(L=l.value.toolbarTips)==null?void 0:L.italic])]);case"strikeThrough":return s("div",{class:`${c}-toolbar-item`,title:(A=l.value.toolbarTips)==null?void 0:A.strikeThrough,onClick:()=>{a("strikeThrough")}},[s(x,{name:"strike-through"},null),e.showToolbarName&&s("div",{class:`${c}-toolbar-item-name`},[(H=l.value.toolbarTips)==null?void 0:H.strikeThrough])]);case"title":return s(ge,{relative:`#${u}`,visible:d.title,onChange:E=>{d.title=E},overlay:s("ul",{class:`${c}-menu`,onClick:()=>{d.title=!1}},[s("li",{class:`${c}-menu-item ${c}-menu-item-title`,onClick:()=>{a("h1")}},[(D=l.value.titleItem)==null?void 0:D.h1]),s("li",{class:`${c}-menu-item ${c}-menu-item-title`,onClick:()=>{a("h2")}},[(M=l.value.titleItem)==null?void 0:M.h2]),s("li",{class:`${c}-menu-item ${c}-menu-item-title`,onClick:()=>{a("h3")}},[(X=l.value.titleItem)==null?void 0:X.h3]),s("li",{class:`${c}-menu-item ${c}-menu-item-title`,onClick:()=>{a("h4")}},[(q=l.value.titleItem)==null?void 0:q.h4]),s("li",{class:`${c}-menu-item ${c}-menu-item-title`,onClick:()=>{a("h5")}},[(U=l.value.titleItem)==null?void 0:U.h5]),s("li",{class:`${c}-menu-item ${c}-menu-item-title`,onClick:()=>{a("h6")}},[(J=l.value.titleItem)==null?void 0:J.h6])])},{default:()=>{var E,V;return[s("div",{class:`${c}-toolbar-item`,title:(E=l.value.toolbarTips)==null?void 0:E.title},[s(x,{name:"title"},null),e.showToolbarName&&s("div",{class:`${c}-toolbar-item-name`},[(V=l.value.toolbarTips)==null?void 0:V.title])])]}});case"sub":return s("div",{class:`${c}-toolbar-item`,title:(ce=l.value.toolbarTips)==null?void 0:ce.sub,onClick:()=>{a("sub")}},[s(x,{name:"sub"},null),e.showToolbarName&&s("div",{class:`${c}-toolbar-item-name`},[(ue=l.value.toolbarTips)==null?void 0:ue.sub])]);case"sup":return s("div",{class:`${c}-toolbar-item`,title:(Y=l.value.toolbarTips)==null?void 0:Y.sup,onClick:()=>{a("sup")}},[s(x,{name:"sup"},null),e.showToolbarName&&s("div",{class:`${c}-toolbar-item-name`},[(le=l.value.toolbarTips)==null?void 0:le.sup])]);case"quote":return s("div",{class:`${c}-toolbar-item`,title:(oe=l.value.toolbarTips)==null?void 0:oe.quote,onClick:()=>{a("quote")}},[s(x,{name:"quote"},null),e.showToolbarName&&s("div",{class:`${c}-toolbar-item-name`},[(W=l.value.toolbarTips)==null?void 0:W.quote])]);case"unorderedList":return s("div",{class:`${c}-toolbar-item`,title:(O=l.value.toolbarTips)==null?void 0:O.unorderedList,onClick:()=>{a("unorderedList")}},[s(x,{name:"unordered-list"},null),e.showToolbarName&&s("div",{class:`${c}-toolbar-item-name`},[(Le=l.value.toolbarTips)==null?void 0:Le.unorderedList])]);case"orderedList":return s("div",{class:`${c}-toolbar-item`,title:(Ve=l.value.toolbarTips)==null?void 0:Ve.orderedList,onClick:()=>{a("orderedList")}},[s(x,{name:"ordered-list"},null),e.showToolbarName&&s("div",{class:`${c}-toolbar-item-name`},[(We=l.value.toolbarTips)==null?void 0:We.orderedList])]);case"task":return s("div",{class:`${c}-toolbar-item`,title:(ze=l.value.toolbarTips)==null?void 0:ze.task,onClick:()=>{a("task")}},[s(x,{name:"task"},null),e.showToolbarName&&s("div",{class:`${c}-toolbar-item-name`},[(Ue=l.value.toolbarTips)==null?void 0:Ue.task])]);case"codeRow":return s("div",{class:`${c}-toolbar-item`,title:(Ge=l.value.toolbarTips)==null?void 0:Ge.codeRow,onClick:()=>{a("codeRow")}},[s(x,{name:"code-row"},null),e.showToolbarName&&s("div",{class:`${c}-toolbar-item-name`},[(qe=l.value.toolbarTips)==null?void 0:qe.codeRow])]);case"code":return s("div",{class:`${c}-toolbar-item`,title:(Ke=l.value.toolbarTips)==null?void 0:Ke.code,onClick:()=>{a("code")}},[s(x,{name:"code"},null),e.showToolbarName&&s("div",{class:`${c}-toolbar-item-name`},[(Ze=l.value.toolbarTips)==null?void 0:Ze.code])]);case"link":return s("div",{class:`${c}-toolbar-item`,title:(Xe=l.value.toolbarTips)==null?void 0:Xe.link,onClick:()=>{n.type="link",n.linkVisible=!0}},[s(x,{name:"link"},null),e.showToolbarName&&s("div",{class:`${c}-toolbar-item-name`},[(Je=l.value.toolbarTips)==null?void 0:Je.link])]);case"image":return e.noUploadImg?s("div",{class:`${c}-toolbar-item`,title:(Ye=l.value.toolbarTips)==null?void 0:Ye.image,onClick:()=>{n.type="image",n.linkVisible=!0}},[s(x,{name:"image"},null),e.showToolbarName&&s("div",{class:`${c}-toolbar-item-name`},[(Qe=l.value.toolbarTips)==null?void 0:Qe.image])]):s(ge,{relative:`#${u}`,visible:d.image,onChange:E=>{d.image=E},overlay:s("ul",{class:`${c}-menu`,onClick:()=>{d.title=!1}},[s("li",{class:`${c}-menu-item ${c}-menu-item-image`,onClick:()=>{n.type="image",n.linkVisible=!0}},[(et=l.value.imgTitleItem)==null?void 0:et.link]),s("li",{class:`${c}-menu-item ${c}-menu-item-image`,onClick:()=>{$.value.click()}},[(tt=l.value.imgTitleItem)==null?void 0:tt.upload]),s("li",{class:`${c}-menu-item ${c}-menu-item-image`,onClick:()=>{n.clipVisible=!0}},[(lt=l.value.imgTitleItem)==null?void 0:lt.clip2upload])])},{default:()=>{var E,V;return[s("div",{class:`${c}-toolbar-item`,title:(E=l.value.toolbarTips)==null?void 0:E.image},[s(x,{name:"image"},null),e.showToolbarName&&s("div",{class:`${c}-toolbar-item-name`},[(V=l.value.toolbarTips)==null?void 0:V.image])])]}});case"table":return s(ge,{relative:`#${u}`,visible:d.table,onChange:E=>{d.table=E},key:"bar-table",overlay:s(cn,{tableShape:e.tableShape,onSelected:E=>{a("table",{selectedShape:E})}},null)},{default:()=>{var E,V;return[s("div",{class:`${c}-toolbar-item`,title:(E=l.value.toolbarTips)==null?void 0:E.table},[s(x,{name:"table"},null),e.showToolbarName&&s("div",{class:`${c}-toolbar-item-name`},[(V=l.value.toolbarTips)==null?void 0:V.table])])]}});case"revoke":return s("div",{class:`${c}-toolbar-item`,title:(ot=l.value.toolbarTips)==null?void 0:ot.revoke,onClick:()=>{C.emit(t,ml)}},[s(x,{name:"revoke"},null),e.showToolbarName&&s("div",{class:`${c}-toolbar-item-name`},[(nt=l.value.toolbarTips)==null?void 0:nt.revoke])]);case"next":return s("div",{class:`${c}-toolbar-item`,title:(at=l.value.toolbarTips)==null?void 0:at.next,onClick:()=>{C.emit(t,gl)}},[s(x,{name:"next"},null),e.showToolbarName&&s("div",{class:`${c}-toolbar-item-name`},[(it=l.value.toolbarTips)==null?void 0:it.next])]);case"save":return s("div",{class:`${c}-toolbar-item`,title:(rt=l.value.toolbarTips)==null?void 0:rt.save,onClick:()=>{C.emit(t,Ee)}},[s(x,{name:"baocun"},null),e.showToolbarName&&s("div",{class:`${c}-toolbar-item-name`},[(st=l.value.toolbarTips)==null?void 0:st.save])]);case"prettier":return e.noPrettier?"":s("div",{class:`${c}-toolbar-item`,title:(ct=l.value.toolbarTips)==null?void 0:ct.prettier,onClick:()=>{a("prettier")}},[s(x,{name:"prettier"},null),e.showToolbarName&&s("div",{class:`${c}-toolbar-item-name`},[(ut=l.value.toolbarTips)==null?void 0:ut.prettier])]);case"pageFullscreen":return!e.setting.fullscreen&&s("div",{class:`${c}-toolbar-item`,title:(dt=l.value.toolbarTips)==null?void 0:dt.pageFullscreen,onClick:()=>{e.updateSetting("pageFullscreen")}},[s(x,{name:e.setting.pageFullscreen?"suoxiao":"fangda"},null),e.showToolbarName&&s("div",{class:`${c}-toolbar-item-name`},[(mt=l.value.toolbarTips)==null?void 0:mt.pageFullscreen])]);case"fullscreen":return s("div",{class:`${c}-toolbar-item`,title:(gt=l.value.toolbarTips)==null?void 0:gt.fullscreen,onClick:()=>{r()}},[s(x,{name:e.setting.fullscreen?"fullscreen-exit":"fullscreen"},null),e.showToolbarName&&s("div",{class:`${c}-toolbar-item-name`},[(ft=l.value.toolbarTips)==null?void 0:ft.fullscreen])]);case"preview":return s("div",{class:`${c}-toolbar-item`,title:(vt=l.value.toolbarTips)==null?void 0:vt.preview,onClick:()=>{e.updateSetting("preview")}},[s(x,{name:"preview"},null),e.showToolbarName&&s("div",{class:`${c}-toolbar-item-name`},[(ht=l.value.toolbarTips)==null?void 0:ht.preview])]);case"htmlPreview":return s("div",{class:`${c}-toolbar-item`,title:(bt=l.value.toolbarTips)==null?void 0:bt.htmlPreview,onClick:()=>{e.updateSetting("htmlPreview")}},[s(x,{name:"coding"},null),e.showToolbarName&&s("div",{class:`${c}-toolbar-item-name`},[(pt=l.value.toolbarTips)==null?void 0:pt.htmlPreview])]);case"catalog":return s("div",{class:`${c}-toolbar-item`,title:(yt=l.value.toolbarTips)==null?void 0:yt.catalog,onClick:()=>{C.emit(t,je)},key:"bar-catalog"},[s(x,{name:"catalog"},null),e.showToolbarName&&s("div",{class:`${c}-toolbar-item-name`},[(kt=l.value.toolbarTips)==null?void 0:kt.catalog])]);case"github":return s("div",{class:`${c}-toolbar-item`,title:(Ct=l.value.toolbarTips)==null?void 0:Ct.github,onClick:()=>wl("https://github.com/imzbf/md-editor-v3")},[s(x,{name:"github"},null),e.showToolbarName&&s("div",{class:`${c}-toolbar-item-name`},[($t=l.value.toolbarTips)==null?void 0:$t.github])]);case"mermaid":return s(ge,{relative:`#${u}`,visible:d.mermaid,onChange:E=>{d.mermaid=E},overlay:s("ul",{class:`${c}-menu`,onClick:()=>{d.mermaid=!1}},[s("li",{class:`${c}-menu-item ${c}-menu-item-mermaid`,onClick:()=>{a("flow")}},[(wt=l.value.mermaid)==null?void 0:wt.flow]),s("li",{class:`${c}-menu-item ${c}-menu-item-mermaid`,onClick:()=>{a("sequence")}},[(Tt=l.value.mermaid)==null?void 0:Tt.sequence]),s("li",{class:`${c}-menu-item ${c}-menu-item-mermaid`,onClick:()=>{a("gantt")}},[(_t=l.value.mermaid)==null?void 0:_t.gantt]),s("li",{class:`${c}-menu-item ${c}-menu-item-mermaid`,onClick:()=>{a("class")}},[(St=l.value.mermaid)==null?void 0:St.class]),s("li",{class:`${c}-menu-item ${c}-menu-item-mermaid`,onClick:()=>{a("state")}},[(xt=l.value.mermaid)==null?void 0:xt.state]),s("li",{class:`${c}-menu-item ${c}-menu-item-mermaid`,onClick:()=>{a("pie")}},[(Et=l.value.mermaid)==null?void 0:Et.pie]),s("li",{class:`${c}-menu-item ${c}-menu-item-mermaid`,onClick:()=>{a("relationship")}},[(It=l.value.mermaid)==null?void 0:It.relationship]),s("li",{class:`${c}-menu-item ${c}-menu-item-mermaid`,onClick:()=>{a("journey")}},[(Lt=l.value.mermaid)==null?void 0:Lt.journey])]),key:"bar-mermaid"},{default:()=>{var E,V;return[s("div",{class:`${c}-toolbar-item`,title:(E=l.value.toolbarTips)==null?void 0:E.mermaid},[s(x,{name:"mermaid"},null),e.showToolbarName&&s("div",{class:`${c}-toolbar-item-name`},[(V=l.value.toolbarTips)==null?void 0:V.mermaid])])]}});case"katex":return s(ge,{relative:`#${u}`,visible:d.katex,onChange:E=>{d.katex=E},overlay:s("ul",{class:`${c}-menu`,onClick:()=>{d.katex=!1}},[s("li",{class:`${c}-menu-item ${c}-menu-item-katex`,onClick:()=>{a("katexInline")}},[(Ht=l.value.katex)==null?void 0:Ht.inline]),s("li",{class:`${c}-menu-item ${c}-menu-item-katex`,onClick:()=>{a("katexBlock")}},[(At=l.value.katex)==null?void 0:At.block])]),key:"bar-katex"},{default:()=>{var E,V;return[s("div",{class:`${c}-toolbar-item`,title:(E=l.value.toolbarTips)==null?void 0:E.katex},[s(x,{name:"formula"},null),e.showToolbarName&&s("div",{class:`${c}-toolbar-item-name`},[(V=l.value.toolbarTips)==null?void 0:V.katex])])]}})}else if(e.defToolbars instanceof Array){const E=e.defToolbars[f];return E?Re(E,{theme:o.value,language:i.value,insert(He){C.emit(t,F,"universal",{generate:He})}}):""}else if(e.defToolbars&&e.defToolbars.children instanceof Array){const E=e.defToolbars.children[f];return E?Re(E,{theme:o.value,language:i.value,insert(He){C.emit(t,F,"universal",{generate:He})}}):""}else return""};return S(()=>e.toolbars,()=>{te(()=>{g.value&&Tl(g.value)})},{immediate:!0}),()=>{const f=k.value[0].map(b=>y(b)),h=k.value[1].map(b=>y(b));return s(xe,null,[e.toolbars.length>0&&s("div",{class:`${c}-toolbar-wrapper`,ref:g,id:u},[s("div",{class:[`${c}-toolbar`,e.showToolbarName&&`${c}-stn`]},[s("div",{class:`${c}-toolbar-left`,ref:m},[f]),s("div",{class:`${c}-toolbar-right`},[h])])]),s("input",{ref:$,accept:"image/*",type:"file",multiple:!0,style:{display:"none"}},null),s(vn,{linkVisible:n.linkVisible,clipVisible:n.clipVisible,type:n.type,onCancel:()=>{n.linkVisible=!1,n.clipVisible=!1},onOk:b=>{b&&a(n.type,{desc:b.desc,url:b.url}),n.linkVisible=!1,n.clipVisible=!1}},null)])}}}),bn=`.${c}-preview > [data-line]`,pn=(e,t)=>{const l=Se(()=>{e.removeEventListener("scroll",o),e.addEventListener("scroll",o),t.removeEventListener("scroll",o),t.addEventListener("scroll",o)},50),o=i=>{const r=e.clientHeight,u=t.clientHeight,g=e.scrollHeight,d=t.scrollHeight,a=(g-r)/(d-u);i.target===e?(t.removeEventListener("scroll",o),t.scrollTo({top:e.scrollTop/a}),l()):(e.removeEventListener("scroll",o),e.scrollTo({top:t.scrollTop*a}),l())};return[()=>{l().finally(()=>{e.dispatchEvent(new Event("scroll"))})},()=>{e.removeEventListener("scroll",o),t.removeEventListener("scroll",o)}]},yn=(e,t,l)=>{const{view:o}=l,i=Sl(),r=f=>o.lineBlockAt(o.state.doc.line(f).from).top,u=f=>o.lineBlockAt(o.state.doc.line(f).from).height;let g=[],d=[],a=[];const n=()=>{var _;g=[],d=[],a=[],d=d.concat(Array.from(t.querySelectorAll(bn)));const f=d.map(w=>Number(w.dataset.line)+1);a=a.concat(f);const{lines:h}=o.state.doc;let b=1,T=(_=f.shift())!=null?_:h;for(let w=1;w<=h;w++)w===T&&(b=w,T=f.shift()||h+1),g.push({start:b,end:T-1})};let m=0,k=0;const $=()=>{var f,h;if(k!==0)return!1;m++;const{scrollDOM:b,contentHeight:T}=o;let _=+getComputedStyle(t).paddingTop.replace("px","");const w=o.lineBlockAtHeight(b.scrollTop),{number:L}=o.state.doc.lineAt(w.from),A=g[L-1];if(!A)return!1;let H=r(A.end)+u(A.end),D=0;const M=r(A.start),X=t.querySelector(`[data-line="${A.start-1}"]`)||((f=t.firstElementChild)==null?void 0:f.firstElementChild),q=t.querySelector(`[data-line="${A.end}"]`)||((h=t.lastElementChild)==null?void 0:h.lastElementChild);let U=0,J=0;M===0?(D=b.scrollTop/H,X===q?(_=0,H=T-b.offsetHeight,U=q.offsetTop+q.offsetHeight-t.clientHeight):U=q.offsetTop):(D=(b.scrollTop-M)/(H-M),J=X.offsetTop,U=q.offsetTop-J),H>b.scrollHeight-b.clientHeight&&(D=(b.scrollTop-M)/(b.scrollHeight-b.clientHeight-M),J=X.offsetTop,U=t.scrollHeight-t.clientHeight-J+10);const ce=J-_+U*D;i(t,ce,()=>{m--})},v=()=>{var f,h,b,T,_,w;if(m!==0)return;k++;const{scrollDOM:L}=o,A=t.scrollTop,H=t.scrollHeight;let D=(f=t.firstElementChild)==null?void 0:f.firstElementChild,M=(h=t.firstElementChild)==null?void 0:h.lastElementChild;if(a.length>0){let oe=Math.ceil(Number(a[a.length-1])*(A/H)),W=a.findLastIndex(O=>O<=oe);W=W===-1?0:W,oe=a[W];for(let O=W;O>=0&&O<a.length;)if(d[O].offsetTop>A){if(O-1>=0){O--;continue}oe=-1,W=O;break}else{if(O+1<=a.length&&d[O+1].offsetTop<A){O++;continue}oe=a[O],W=O;break}switch(oe){case-1:{D=(b=t.firstElementChild)==null?void 0:b.firstElementChild,M=d[W];break}case a.length-1:{D=d[W],M=(T=t.firstElementChild)==null?void 0:T.lastElementChild;break}default:D=d[W],M=d[W+1]}}const X=D===((_=t.firstElementChild)==null?void 0:_.firstElementChild)?0:D.offsetTop;let q=M.offsetTop,U=0;const{start:J,end:ce}=g[Number(D.dataset.line||0)],ue=r(J);let Y=r(ce+1),le=0;Y>L.scrollHeight-L.clientHeight||M.scrollTop>t.scrollHeight-t.clientHeight?(U=Math.max((A-X)/(t.scrollHeight-X-t.clientHeight),0),Y=r(o.state.doc.lines)+u(o.state.doc.lines),le=8+Y-ue-e.clientHeight):D===((w=t.firstElementChild)==null?void 0:w.firstElementChild)?(D===M&&(q=M.offsetTop+M.offsetHeight+ +getComputedStyle(M).marginBottom.replace("px","")),le=Y,U=Math.max(A/q,0)):(U=Math.max((A-X)/(q-X),0),le=Y-ue),i(e,ue+le*U,()=>{k--})},y=_l(f=>{var h;const{scrollDOM:b,contentHeight:T}=o,_=b.clientHeight;if(T<=_||t.firstElementChild.clientHeight<=t.clientHeight||o.state.doc.lines<((h=g[g.length-1])==null?void 0:h.end))return!1;f.target===e?$():v()},8);return[()=>{n(),e.addEventListener("scroll",y),t.addEventListener("scroll",y),e.dispatchEvent(new Event("scroll"))},()=>{e.removeEventListener("scroll",y),t.removeEventListener("scroll",y)}]},kn=(e,t,l)=>{const o=I("editorId");let i=()=>{},r=()=>{};const u=()=>{i();const g=document.querySelector(`#${o} .cm-scroller`),d=document.querySelector(`[id="${o}-preview-wrapper"]`),a=document.querySelector(`[id="${o}-html-wrapper"]`);(d||a)&&([r,i]=(d?yn:pn)(g,d||a,l.value)),e.scrollAuto&&r()};S([t,ie(e.setting,"preview"),ie(e.setting,"htmlPreview"),ie(e.setting,"fullscreen"),ie(e.setting,"pageFullscreen")],()=>{te(u)}),S(()=>e.scrollAuto,g=>{g?r():i()}),R(u)},Cn=(e,t,l)=>{var f;var o,i,r,u,g,d;let a="",n=0,m=0,k=!0,$=!1;const v=t.getSelectedText(),y=(o=j.editorConfig)==null?void 0:o.mermaidTemplate;if(/^h[1-6]{1}$/.test(e)){const h=e.replace(/^h(\d)/,(b,T)=>new Array(Number(T)).fill("#",0,T).join(""));a=`${h} ${v}`,n=h.length+1}else if(e==="prettier"){const h=window.prettier||((r=(i=j.editorExtensions)==null?void 0:i.prettier)==null?void 0:r.prettierInstance),b=[((u=window.prettierPlugins)==null?void 0:u.markdown)||((d=(g=j.editorExtensions)==null?void 0:g.prettier)==null?void 0:d.parserMarkdownInstance)];!h||b[0]===void 0?(C.emit(l.editorId,se,{name:"prettier",message:"prettier is undefined"}),a=t.getValue()):a=h.format(t.getValue(),{parser:"markdown",plugins:b}),k=!1,$=!0}else switch(e){case"bold":{a=`**${v}**`,n=2,m=-2;break}case"underline":{a=`<u>${v}</u>`,n=3,m=-4;break}case"italic":{a=`*${v}*`,n=1,m=-1;break}case"strikeThrough":{a=`~~${v}~~`,n=2,m=-2;break}case"sub":{a=`<sub>${v}</sub>`,n=5,m=-6;break}case"sup":{a=`<sup>${v}</sup>`,n=5,m=-6;break}case"codeRow":{a="`"+v+"`",n=1,m=-1;break}case"quote":{a=`> ${v}`,n=2;break}case"orderedList":{a=`1. ${v}`,n=3;break}case"unorderedList":{a=`- ${v}`,n=2;break}case"task":{a=`- [ ] ${v}`,n=6;break}case"code":{const h=l.text||v||"",b=l.mode||"language";a=`\`\`\`${b}
${h}
\`\`\`
`,n=3,m=3+b.length-a.length;break}case"table":{a="|";const{selectedShape:h={x:1,y:1}}=l,{x:b,y:T}=h;for(let _=0;_<=T;_++)a+=" col |";a+=`
|`;for(let _=0;_<=T;_++)a+=" - |";for(let _=0;_<=b;_++){a+=`
|`;for(let w=0;w<=T;w++)a+=" content |"}n=2,m=5-a.length;break}case"link":{const{desc:h,url:b}=l;a=`[${h}](${b})`,k=!1;break}case"image":{const{desc:h,url:b,urls:T}=l;T instanceof Array?a=T.reduce((_,w)=>{const{url:L="",alt:A="",title:H=""}=typeof w=="object"?w:{url:w};return _+`![${A}](${L}${H?" '"+H+"'":""})
`},""):a=`![${h}](${b})
`,k=!1;break}case"flow":{a=`\`\`\`mermaid
${(y==null?void 0:y.flow)||`flowchart TD 
  Start --> Stop`}
\`\`\`
`,n=3,m=10-a.length;break}case"sequence":{a=`\`\`\`mermaid
${(y==null?void 0:y.sequence)||`sequenceDiagram
  A->>B: hello!
  B-->>A: hi!
  A-)B: bye!`}
\`\`\`
`,n=3,m=10-a.length;break}case"gantt":{a=`\`\`\`mermaid
${(y==null?void 0:y.gantt)||`gantt
title A Gantt Diagram
dateFormat  YYYY-MM-DD
section Section
A task  :a1, 2014-01-01, 30d
Another task  :after a1, 20d`}
\`\`\`
`,n=3,m=10-a.length;break}case"class":{a=`\`\`\`mermaid
${(y==null?void 0:y.class)||`classDiagram
  class Animal
  Vehicle <|-- Car`}
\`\`\`
`,n=3,m=10-a.length;break}case"state":{a=`\`\`\`mermaid
${(y==null?void 0:y.state)||`stateDiagram-v2
  s1 --> s2`}
\`\`\`
`,n=3,m=10-a.length;break}case"pie":{a=`\`\`\`mermaid
${(y==null?void 0:y.pie)||`pie title Pets adopted by volunteers
  "Dogs" : 386
  "Cats" : 85
  "Rats" : 15`}
\`\`\`
`,n=3,m=10-a.length;break}case"relationship":{a=`\`\`\`mermaid
${(y==null?void 0:y.relationship)||`erDiagram
  CAR ||--o{ NAMED-DRIVER : allows
  PERSON ||--o{ NAMED-DRIVER : is`}
\`\`\`
`,n=3,m=10-a.length;break}case"journey":{a=`\`\`\`mermaid
${(y==null?void 0:y.journey)||`journey
  title My working day
  section Go to work
    Make tea: 5: Me
    Go upstairs: 3: Me
    Do work: 1: Me, Cat
  section Go home
    Go downstairs: 5: Me
    Sit down: 5: Me`}
\`\`\`
`,n=3,m=10-a.length;break}case"katexInline":{a="$$",n=1,m=-1;break}case"katexBlock":{a=`$$

$$
`,n=3,m=-4;break}case"universal":{const{generate:h}=l,b=h(v);a=b.targetValue,k=(f=b.select)!=null?f:!0,n=b.deviationStart||0,m=b.deviationEnd||0}}return{text:a,options:{select:k,deviationStart:n,deviationEnd:m,replaceAll:$}}},$n="#e5c07b",qt="var(--md-color)",wn="#56b6c2",Tn="#ffffff",ve="var(--md-color)",Kt="#e5c07b",_n="#e5c07b",Sn="var(--md-color)",Zt="#d19a66",xn="#c678dd",En="#21252b",In="#2c313a",Xt="var(--md-bk-color)",Me="var(--md-bk-color)",Ln="#ceedfa33",Jt="#528bff",Hn=ae.theme({"&":{color:ve,backgroundColor:Xt},".cm-content":{caretColor:Jt},".cm-cursor, .cm-dropCursor":{borderLeftColor:Jt},"&.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground, .cm-selectionBackground, .cm-content ::selection":{backgroundColor:Ln},".cm-panels":{backgroundColor:En,color:ve},".cm-panels.cm-panels-top":{borderBottom:"2px solid black"},".cm-panels.cm-panels-bottom":{borderTop:"2px solid black"},".cm-searchMatch":{backgroundColor:"#72a1ff59",outline:"1px solid #457dff"},".cm-searchMatch.cm-searchMatch-selected":{backgroundColor:"#6199ff2f"},".cm-activeLine":{backgroundColor:"#ceedfa33"},".cm-selectionMatch":{backgroundColor:"#aafe661a"},"&.cm-focused .cm-matchingBracket, &.cm-focused .cm-nonmatchingBracket":{backgroundColor:"#bad0f847"},".cm-gutters":{backgroundColor:Xt,color:ve,borderRight:"1px solid",borderColor:"var(--md-border-color)"},".cm-activeLineGutter":{backgroundColor:In},".cm-foldPlaceholder":{backgroundColor:"transparent",border:"none",color:"#ddd"},".cm-tooltip":{border:"1px solid var(--md-border-color)",backgroundColor:Me},".cm-tooltip .cm-tooltip-arrow:before":{borderTopColor:"transparent",borderBottomColor:"transparent"},".cm-tooltip .cm-tooltip-arrow:after":{borderTopColor:Me,borderBottomColor:Me},".cm-tooltip-autocomplete":{"& > ul > li[aria-selected]":{color:ve}}},{dark:!0}),An=rl.define([{tag:p.keyword,color:xn},{tag:[p.name,p.deleted,p.character,p.propertyName,p.macroName],color:qt},{tag:[p.function(p.variableName),p.labelName],color:_n},{tag:[p.color,p.constant(p.name),p.standard(p.name)],color:Zt},{tag:[p.definition(p.name),p.separator],color:ve},{tag:[p.typeName,p.className,p.number,p.changed,p.annotation,p.modifier,p.self,p.namespace],color:$n},{tag:[p.operator,p.operatorKeyword,p.url,p.escape,p.regexp,p.link,p.special(p.string)],color:wn},{tag:[p.meta,p.comment],color:Kt},{tag:p.strong,fontWeight:"bold"},{tag:p.emphasis,fontStyle:"italic"},{tag:p.strikethrough,textDecoration:"line-through"},{tag:p.link,color:Kt,textDecoration:"underline"},{tag:p.heading,fontWeight:"bold",color:qt},{tag:[p.atom,p.bool,p.special(p.variableName)],color:Zt},{tag:[p.processingInstruction,p.string,p.inserted],color:Sn},{tag:p.invalid,color:Tn}]),Yt=[Hn,sl(An)],Mn="#e5c07b",Qt="#3f4a54",Fn="#56b6c2",Pn="#fff",he="#3f4a54",el="#2d8cf0",Bn="#2d8cf0",Rn="#3f4a54",tl="#d19a66",Nn="#c678dd",Dn="#21252b",jn="#ceedfa33",ll="var(--md-bk-color)",Fe="var(--md-bk-color)",On="#bad5fa",ol="#3f4a54",Vn=ae.theme({"&":{color:he,backgroundColor:ll},".cm-content":{caretColor:ol},".cm-cursor, .cm-dropCursor":{borderLeftColor:ol},"&.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground, .cm-selectionBackground, .cm-content ::selection":{backgroundColor:On},".cm-panels":{backgroundColor:Dn,color:he},".cm-panels.cm-panels-top":{borderBottom:"2px solid black"},".cm-panels.cm-panels-bottom":{borderTop:"2px solid black"},".cm-searchMatch":{backgroundColor:"#72a1ff59",outline:"1px solid #457dff"},".cm-searchMatch.cm-searchMatch-selected":{backgroundColor:"#6199ff2f"},".cm-activeLine":{backgroundColor:"#ceedfa33"},".cm-selectionMatch":{backgroundColor:"#aafe661a"},"&.cm-focused .cm-matchingBracket, &.cm-focused .cm-nonmatchingBracket":{backgroundColor:"#bad0f847"},".cm-gutters":{backgroundColor:ll,color:he,borderRight:"1px solid",borderColor:"var(--md-border-color)"},".cm-activeLineGutter":{backgroundColor:jn},".cm-foldPlaceholder":{backgroundColor:"transparent",border:"none",color:"#ddd"},".cm-tooltip":{border:"1px solid var(--md-border-color)",backgroundColor:Fe},".cm-tooltip .cm-tooltip-arrow:before":{borderTopColor:"transparent",borderBottomColor:"transparent"},".cm-tooltip .cm-tooltip-arrow:after":{borderTopColor:Fe,borderBottomColor:Fe},".cm-tooltip-autocomplete":{"& > ul > li[aria-selected]":{color:he}}}),Wn=rl.define([{tag:p.keyword,color:Nn},{tag:[p.name,p.deleted,p.character,p.propertyName,p.macroName],color:Qt},{tag:[p.function(p.variableName),p.labelName],color:Bn},{tag:[p.color,p.constant(p.name),p.standard(p.name)],color:tl},{tag:[p.definition(p.name),p.separator],color:he},{tag:[p.typeName,p.className,p.number,p.changed,p.annotation,p.modifier,p.self,p.namespace],color:Mn},{tag:[p.operator,p.operatorKeyword,p.url,p.escape,p.regexp,p.link,p.special(p.string)],color:Fn},{tag:[p.meta,p.comment],color:el},{tag:p.strong,fontWeight:"bold"},{tag:p.emphasis,fontStyle:"italic"},{tag:p.strikethrough,textDecoration:"line-through"},{tag:p.link,color:el,textDecoration:"underline"},{tag:p.heading,fontWeight:"bold",color:Qt},{tag:[p.atom,p.bool,p.special(p.variableName)],color:tl},{tag:[p.processingInstruction,p.string,p.inserted],color:Rn},{tag:p.invalid,color:Pn}]),nl=[Vn,sl(Wn)],ke=(e,t,l,o,i)=>(r,u,g,d)=>{const a=`${e}${t}`.slice(d-g);r.dispatch(r.state.replaceSelection(`${a}${l}${o}`));const n=g+u.label.length+(i==="title"?l.length:0);r.dispatch({selection:ee.create([ee.range(g+u.label.length+(i==="title"?1:-t.length),n),ee.cursor(n)],1)}),r.focus()},al=e=>(t,l,o,i)=>{const r=e.slice(i-o);t.dispatch(t.state.replaceSelection(`${r} `))},il=e=>{const t=l=>{const o=l.matchBefore(/^#+|^-\s*\[*\s*\]*|`+|\[|!\[*|^\|\s?\|?|^\$\$?|!+\s*\w*/);return o===null||o.from==o.to&&l.explicit?null:{from:o.from,options:[...["h1","h2","h3","h4","h5","h6"].map((i,r)=>{const u=new Array(r+1).fill("#").join("");return{label:u,type:"text",apply:al(u)}}),...["unchecked","checked"].map(i=>{const r=i==="checked"?"- [x]":"- [ ]";return{label:r,type:"text",apply:al(r)}}),...[["`",""],["```","language"],["```mermaid\n",""]].map(i=>({label:`${i[0]}${i[1]}`,type:"text",apply:ke(i[0],i[1],"",i[0]==="`"?"`":"\n```","type")})),{label:"[]()",type:"text"},{label:"![]()",type:"text"},{label:"| |",type:"text",detail:"table",apply:`| col | col | col |
| - | - | - |
| content | content | content |
| content | content | content |`},{label:"$",type:"text",apply:ke("$","","","$","type")},{label:"$$",type:"text",apply:ke("$$","",`
`,`
$$`,"title")},...["note","abstract","info","tip","success","question","warning","failure","danger","bug","example","quote","hint","caution","error","attention"].map(i=>({label:`!!! ${i}`,type:"text",apply:ke("!!!",` ${i}`," Title",`

!!!`,"title")}))]}};return Dl({override:e?[t,...e]:[t]})},de=e=>{const t=new me;return o=>(t.get(e.state)?e.dispatch({effects:t.reconfigure(o)}):e.dispatch({effects:Wl.appendConfig.of(t.of(o))}),!0)};class zn{constructor(t){ne(this,"view"),ne(this,"maxLength",Number.MAX_SAFE_INTEGER),ne(this,"toggleTabSize"),ne(this,"togglePlaceholder"),ne(this,"setExtensions"),ne(this,"toggleDisabled"),ne(this,"toggleReadOnly"),ne(this,"toggleMaxlength"),this.view=t,this.toggleTabSize=de(this.view),this.togglePlaceholder=de(this.view),this.setExtensions=de(this.view),this.toggleDisabled=de(this.view),this.toggleReadOnly=de(this.view),this.toggleMaxlength=de(this.view)}getValue(){return this.view.state.doc.toString()}setValue(t,l=0,o=this.view.state.doc.length){this.view.dispatch({changes:{from:l,to:o,insert:t}})}getSelectedText(){const{from:t,to:l}=this.view.state.selection.main;return this.view.state.sliceDoc(t,l)}replaceSelectedText(t,l={select:!0,deviationStart:0,deviationEnd:0,replaceAll:!1},o){try{if(l.replaceAll){if(this.setValue(t),t.length>this.maxLength)throw new Error("The input text is too long");return}if(this.view.state.doc.length-this.getSelectedText().length+t.length>this.maxLength)throw new Error("The input text is too long");const{from:i}=this.view.state.selection.main;if(this.view.dispatch(this.view.state.replaceSelection(t)),l.select){const r=i+t.length+l.deviationEnd;this.view.dispatch({selection:ee.create([ee.range(i+l.deviationStart,r),ee.cursor(r)],1)})}this.view.focus()}catch(i){if(i.message==="The input text is too long")C.emit(o,se,{name:"overlength",message:i.message,data:t});else throw i}}setTabSize(t){this.toggleTabSize([Ae.tabSize.of(t),jl.of(" ".repeat(t))])}setPlaceholder(t){this.togglePlaceholder(Ol(t))}focus(t){if(this.view.focus(),!t)return;let l=0,o=0,i=0;switch(t){case"start":break;case"end":{l=o=i=this.getValue().length;break}default:l=t.rangeAnchor||t.cursorPos,o=t.rangeHead||t.cursorPos,i=t.cursorPos}this.view.dispatch({scrollIntoView:!0,selection:ee.create([ee.range(l,o),ee.cursor(i)],1)})}setDisabled(t){this.toggleDisabled([ae.editable.of(!t)])}setReadOnly(t){this.toggleReadOnly([Ae.readOnly.of(t)])}setMaxLength(t){this.maxLength=t,this.toggleMaxlength([Ae.changeFilter.of(l=>l.newDoc.length<=t)])}}const Un=e=>{const t=I("editorId");return o=>{if(!o.clipboardData)return;if(o.clipboardData.files.length>0){const{files:r}=o.clipboardData;C.emit(t,Ie,Array.from(r).filter(u=>/image\/.*/.test(u.type))),o.preventDefault();return}if(e.autoDetectCode&&o.clipboardData.types.includes("vscode-editor-data")){const r=JSON.parse(o.clipboardData.getData("vscode-editor-data"));C.emit(t,F,"code",{mode:r.mode,text:o.clipboardData.getData("text/plain")}),o.preventDefault();return}const i=o.clipboardData.getData("text/plain");e.maxlength&&i.length+e.modelValue.length>e.maxlength&&C.emit(t,se,{name:"overlength",message:"The input text is too long",data:i})}},Gn=(e,t)=>[{key:"Ctrl-b",mac:"Cmd-b",run:()=>(C.emit(e,F,"bold"),!0)},{key:"Ctrl-d",mac:"Cmd-d",run:Vl,preventDefault:!0},{key:"Ctrl-s",mac:"Cmd-s",run:_=>(C.emit(e,Ee,_.state.doc.toString()),!0),shift:()=>(C.emit(e,F,"strikeThrough"),!0)},{key:"Ctrl-u",mac:"Cmd-u",run:()=>(C.emit(e,F,"underline"),!0),shift:()=>(C.emit(e,F,"unorderedList"),!0)},{key:"Ctrl-i",mac:"Cmd-i",run:()=>(C.emit(e,F,"italic"),!0),shift:()=>(C.emit(e,Ne,"image"),!0)},{key:"Ctrl-1",mac:"Cmd-1",run:()=>(C.emit(e,F,"h1"),!0)},{key:"Ctrl-2",mac:"Cmd-2",run:()=>(C.emit(e,F,"h2"),!0)},{key:"Ctrl-3",mac:"Cmd-3",run:()=>(C.emit(e,F,"h3"),!0)},{key:"Ctrl-4",mac:"Cmd-4",run:()=>(C.emit(e,F,"h4"),!0)},{key:"Ctrl-5",mac:"Cmd-5",run:()=>(C.emit(e,F,"h5"),!0)},{key:"Ctrl-6",mac:"Cmd-6",run:()=>(C.emit(e,F,"h6"),!0)},{key:"Ctrl-ArrowUp",mac:"Cmd-ArrowUp",run:()=>(C.emit(e,F,"sup"),!0)},{key:"Ctrl-ArrowDown",mac:"Cmd-ArrowDown",run:()=>(C.emit(e,F,"sub"),!0)},{key:"Ctrl-o",mac:"Cmd-o",run:()=>(C.emit(e,F,"orderedList"),!0)},{key:"Ctrl-c",mac:"Cmd-c",shift:()=>(C.emit(e,F,"code"),!0),any(_,w){return(w.ctrlKey||w.metaKey)&&w.altKey&&w.code==="KeyC"?(C.emit(e,F,"codeRow"),!0):!1}},{key:"Ctrl-l",mac:"Cmd-l",run:()=>(C.emit(e,Ne,"link"),!0)},{key:"Ctrl-f",mac:"Cmd-f",shift:()=>t.noPrettier?!1:(C.emit(e,F,"prettier"),!0)},{any:(_,w)=>(w.ctrlKey||w.metaKey)&&w.altKey&&w.shiftKey&&w.code==="KeyT"?(C.emit(e,F,"table"),!0):!1}],qn=e=>{const t=I("tabWidth"),l=I("editorId"),o=I("theme"),i=B(),r=re(),u=new me,g=new me,d=new me,a=new me,n=new me,m=Gn(l,e),k=B(!1),v={paste:Un(e),blur:e.onBlur,focus:e.onFocus,drop:e.onDrop,compositionstart:()=>{console.log("compositionstart"),k.value=!0},compositionend:(h,b)=>{console.log("compositionend"),k.value=!1,e.updateModelValue(b.state.doc.toString())},input:h=>{e.onInput&&e.onInput(h);const{data:b}=h;e.maxlength&&e.modelValue.length+b.length>e.maxlength&&C.emit(l,se,{name:"overlength",message:"The input text is too long",data:b})}},y=[Hl.of([...Al,...Ml,...m,Fl]),a.of(Mt()),u.of(Pl({codeLanguages:Bl})),ae.lineWrapping,ae.updateListener.of(h=>{h.docChanged&&(e.onChange(h.state.doc.toString()),k.value||e.updateModelValue(h.state.doc.toString()))}),n.of(ae.domEventHandlers(v))],f=()=>{const h=[...y,g.of(o.value==="light"?nl:Yt),d.of(il(e.completions))];return j.codeMirrorExtensions(o.value,h,[...m])};return R(()=>{const h=new ae({doc:e.modelValue,parent:i.value,extensions:[f()]}),b=new zn(h);r.value=b,setTimeout(()=>{b.setTabSize(t),b.setDisabled(e.disabled),b.setReadOnly(e.readonly),e.placeholder&&b.setPlaceholder(e.placeholder),typeof e.maxlength=="number"&&b.setMaxLength(e.maxlength),e.autofocus&&h.focus()},0),C.on(l,{name:ml,callback(){Rl(h)}}),C.on(l,{name:gl,callback(){Nl(h)}}),C.on(l,{name:F,callback(T,_={}){var w;const{text:L,options:A}=Cn(T,r.value,_);(w=r.value)==null||w.replaceSelectedText(L,A,l)}}),C.on(l,{name:vl,callback(T){var _;const w={...v},L=Object.keys(v);for(const A in T){const H=A;L.includes(H)?w[H]=(D,M)=>{T[H](D,M),D.defaultPrevented||v[H](D,M)}:w[H]=T[H]}(_=r.value)==null||_.view.dispatch({effects:n.reconfigure(ae.domEventHandlers(w))})}})}),S(o,()=>{var h;(h=r.value)==null||h.view.dispatch({effects:g.reconfigure(o.value==="light"?nl:Yt)})},{deep:!0}),S(()=>e.completions,()=>{var h;(h=r.value)==null||h.view.dispatch({effects:d.reconfigure(il(e.completions))})},{deep:!0}),S(()=>e.modelValue,()=>{var h,b;((h=r.value)==null?void 0:h.getValue())!==e.modelValue&&((b=r.value)==null||b.setValue(e.modelValue))}),S(()=>e.placeholder,()=>{var h;(h=r.value)==null||h.setPlaceholder(e.placeholder)}),S(()=>e.disabled,()=>{var h;(h=r.value)==null||h.setDisabled(e.disabled)}),S(()=>e.readonly,()=>{var h;(h=r.value)==null||h.setDisabled(e.readonly)}),S(()=>e.maxlength,()=>{var h;e.maxlength&&((h=r.value)==null||h.setMaxLength(e.maxlength))}),{inputWrapperRef:i,codeMirrorUt:r,resetHistory(){var h,b;(h=r.value)==null||h.view.dispatch({effects:a.reconfigure([])}),(b=r.value)==null||b.view.dispatch({effects:a.reconfigure(Mt())})}}},Kn=(e,t,l)=>{const o=z({resizedWidth:e.inputBoxWitdh}),i=z({width:e.inputBoxWitdh}),r=z({left:e.inputBoxWitdh,display:"initial"}),u=a=>{var n,m,k;const $=((n=t.value)==null?void 0:n.offsetWidth)||0,v=((m=t.value)==null?void 0:m.getBoundingClientRect().x)||0;let y=a.x-v;y<ye?y=ye:y>$-ye&&(y=$-ye);const f=`${y}px`;i.width=f,r.left=f,o.resizedWidth=f,(k=e.onInputBoxWitdhChange)==null||k.call(e,f)},g=()=>{document.addEventListener("mousemove",u)},d=()=>{document.removeEventListener("mousemove",u)};return R(()=>{var a;(a=l.value)==null||a.addEventListener("mousedown",g),document.addEventListener("mouseup",d)}),pe(()=>{var a,n;(a=l.value)==null||a.removeEventListener("mousedown",g),(n=l.value)==null||n.removeEventListener("mouseup",d)}),S(()=>e.inputBoxWitdh,a=>{a&&(i.width=a,r.left=a)}),S([ie(e.setting,"htmlPreview"),ie(e.setting,"preview")],()=>{!e.setting.htmlPreview&&!e.setting.preview?(i.width="100%",r.display="none"):(i.width=o.resizedWidth,r.display="initial")},{immediate:!0}),{inputWrapperStyle:i,resizeOperateStyle:r}},Zn=N({name:"MDEditorContent",props:Ro,setup(e,t){const l=I("editorId"),o=B(""),i=B(),r=B(),{inputWrapperRef:u,codeMirrorUt:g,resetHistory:d}=qn(e),{inputWrapperStyle:a,resizeOperateStyle:n}=Kn(e,i,r);return kn(e,o,g),t.expose({getSelectedText(){var m;return(m=g.value)==null?void 0:m.getSelectedText()},focus(m){var k;(k=g.value)==null||k.focus(m)},resetHistory:d}),()=>s("div",{class:`${c}-content${e.setting.htmlPreview||e.setting.preview?" has-preview":""}`,ref:i},[s("div",{class:`${c}-input-wrapper`,style:a,ref:u},null),(e.setting.htmlPreview||e.setting.preview)&&s("div",{class:`${c}-resize-operate`,style:n,ref:r},null),s(bl,{modelValue:e.modelValue,setting:e.setting,onHtmlChanged:m=>{o.value=m,e.onHtmlChanged(m)},onGetCatalog:e.onGetCatalog,mdHeadingId:e.mdHeadingId,noMermaid:e.noMermaid,sanitize:e.sanitize,noKatex:e.noKatex,formatCopiedText:e.formatCopiedText,noHighlight:e.noHighlight,noImgZoomIn:e.noImgZoomIn,sanitizeMermaid:e.sanitizeMermaid},null),e.catalogVisible&&s(be,{theme:e.theme,class:`${c}-catalog-editor`,editorId:l,mdHeadingId:e.mdHeadingId,key:"internal-catalog"},null)])}}),Xn=N({props:{modelValue:{type:String,default:""}},setup(e){const t=I("usedLanguageText");return()=>{var l,o;return s("div",{class:`${c}-footer-item`},[s("label",{class:`${c}-footer-label`},[`${(l=t.value.footer)==null?void 0:l.markdownTotal}:`]),s("span",null,[((o=e.modelValue)==null?void 0:o.length)||0])])}}}),Jn={checked:{type:Boolean,default:!1},onChange:{type:Function,default:()=>{}}},Yn=N({props:Jn,setup(e){return()=>s("div",{class:[`${c}-checkbox`,e.checked&&`${c}-checkbox-checked`],onClick:()=>{e.onChange(!e.checked)}},null)}}),Qn={scrollAuto:{type:Boolean},onScrollAutoChange:{type:Function,default:()=>{}}},ea=N({props:Qn,setup(e){const t=I("usedLanguageText");return()=>{var l;return s("div",{class:`${c}-footer-item`},[s("label",{class:`${c}-footer-label`,onClick:()=>{e.onScrollAutoChange(!e.scrollAuto)}},[(l=t.value.footer)==null?void 0:l.scrollAuto]),s(Yn,{checked:e.scrollAuto,onChange:e.onScrollAutoChange},null)])}}}),ta={modelValue:{type:String,default:""},footers:{type:Array,default:[]},scrollAuto:{type:Boolean},onScrollAutoChange:{type:Function,default:()=>{}},defFooters:{type:Object}},la=N({name:"MDEditorFooter",props:ta,setup(e){const t=G(()=>{const o=e.footers.indexOf("="),i=o===-1?e.footers:e.footers.slice(0,o),r=o===-1?[]:e.footers.slice(o,Number.MAX_SAFE_INTEGER);return[i,r]}),l=o=>{if(ul.includes(o))switch(o){case"markdownTotal":return s(Xn,{modelValue:e.modelValue},null);case"scrollSwitch":return s(ea,{scrollAuto:e.scrollAuto,onScrollAutoChange:e.onScrollAutoChange},null)}else return e.defFooters instanceof Array?e.defFooters[o]||"":e.defFooters&&e.defFooters.children instanceof Array&&e.defFooters.children[o]||""};return()=>{const o=t.value[0].map(r=>l(r)),i=t.value[1].map(r=>l(r));return s("div",{class:`${c}-footer`},[s("div",{class:`${c}-footer-left`},[o]),s("div",{class:`${c}-footer-right`},[i])])}}}),Pe=N({name:"MdEditorV3",props:Go,emits:qo,setup(e,t){const{editorId:l,noKatex:o,noMermaid:i,noPrettier:r,noUploadImg:u,noHighlight:g}=e,d=z({scrollAuto:e.scrollAuto}),a=B();No(e,t),Do(e),jo(e),Oo(e,t);const[n,m]=Vo(e,t),k=Wo(e);return pe(()=>{C.clear(l)}),zo(e,t,k,n,m,a),()=>{var $;const v=Z({props:e,ctx:t},"defToolbars"),y=Z({props:e,ctx:t},"defFooters");return s("div",{id:l,class:[c,e.class,e.theme==="dark"&&`${c}-dark`,n.fullscreen||n.pageFullscreen?`${c}-fullscreen`:""],style:e.style},[s(hn,{noPrettier:r,toolbars:e.toolbars,toolbarsExclude:e.toolbarsExclude,setting:n,updateSetting:m,tableShape:e.tableShape,defToolbars:v,noUploadImg:u,showToolbarName:e.showToolbarName},null),s(Zn,{ref:a,modelValue:e.modelValue,setting:n,mdHeadingId:e.mdHeadingId,noMermaid:i,noPrettier:r,sanitize:e.sanitize,placeholder:e.placeholder,noKatex:o,scrollAuto:d.scrollAuto,formatCopiedText:e.formatCopiedText,autofocus:e.autoFocus,disabled:e.disabled,readonly:e.readOnly,maxlength:e.maxLength,autoDetectCode:e.autoDetectCode,noHighlight:g,updateModelValue:f=>{t.emit("update:modelValue",f)},onChange:f=>{e.onChange&&e.onChange(f),t.emit("onChange",f)},onHtmlChanged:f=>{e.onHtmlChanged&&e.onHtmlChanged(f),t.emit("onHtmlChanged",f)},onGetCatalog:f=>{e.onGetCatalog&&e.onGetCatalog(f),t.emit("onGetCatalog",f)},onBlur:f=>{e.onBlur&&e.onBlur(f),t.emit("onBlur",f)},onFocus:f=>{e.onFocus&&e.onFocus(f),t.emit("onFocus",f)},onInput:f=>{e.onInput&&e.onInput(f),t.emit("onInput",f)},completions:e.completions,catalogVisible:k.value,theme:e.theme,noImgZoomIn:e.noImgZoomIn,onDrop:f=>{e.onDrop&&e.onDrop(f),t.emit("onDrop",f)},inputBoxWitdh:e.inputBoxWitdh,onInputBoxWitdhChange:f=>{e.onInputBoxWitdhChange&&e.onInputBoxWitdhChange(f),t.emit("onInputBoxWitdhChange",f)},sanitizeMermaid:e.sanitizeMermaid},null),(($=e.footers)==null?void 0:$.length)>0&&s(la,{modelValue:e.modelValue,footers:e.footers,defFooters:y,scrollAuto:d.scrollAuto,onScrollAutoChange:f=>d.scrollAuto=f},null)])}}});Pe.install=e=>(e.component(Pe.name,Pe),e.use(Te).use(Ce).use(_e).use(be).use(we),e);export{Pe as E,we as M};
