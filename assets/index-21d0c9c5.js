import{v as x}from"./element-plus-78da4f18.js";import{d as z,r as d,S as E,m as H,f as I,C as b,Q as k,c as g,a as y,G as B,a5 as F,P as w,o as f,z as T}from"./@vue-7d7101e0.js";import{_ as $}from"./index-d16b79dc.js";function q(r){let e=!1;return function(...a){e||(e=!0,window.requestAnimationFrame(()=>{r.apply(this,a),e=!1}))}}function P(r,e=300){let a=null;return function(...l){a&&clearTimeout(a),a=setTimeout(()=>{r.apply(this,l)},e)}}const R={class:"fs-waterfall-container"},C={class:"fs-waterfall-list"},M=z({__name:"index",props:{gap:{},column:{},pageSize:{},request:{type:Function},isScroll:{type:Boolean}},setup(r){const e=r,a=d(),l=d([]),c=d([]),t=E({loading:!1,isfinish:!1,page:1,imageWidth:0,imageList:[]});console.log(t.imageList);const L=H(()=>{let s=-1,o=1/0;for(let n=0;n<l.value.length;n++){const i=l.value[n];i<o&&(s=n,o=i)}return{minIndex:s,minHeight:o}}),p=async(s,o,n)=>{if(t.isfinish)return;t.loading=!0;const i=await e.request(s,o);if(t.page++,!i.length){t.isfinish=!0;return}h(i,n),t.imageList=[...t.imageList,...i],t.loading=!1},h=(s,o)=>{s.forEach((n,i)=>{const u=Math.floor(n.height*t.imageWidth/n.width);if(o&&i<e.column)c.value.push({x:i%e.column!==0?i*t.imageWidth+e.gap*i:i*t.imageWidth,y:0}),l.value.push(u+e.gap);else{const{minIndex:m,minHeight:S}=L.value;c.value.push({x:m%e.column!==0?m*t.imageWidth+e.gap*m:m*t.imageWidth,y:S}),l.value[m]+=u+e.gap}})},v=q(()=>{const{scrollTop:s,clientHeight:o,scrollHeight:n}=a.value;n-o-s<=100&&!t.loading&&p(t.page,e.pageSize,!1)}),_=P(()=>{a.value&&(t.imageWidth=(a.value.clientWidth-(e.column-1)*e.gap)/e.column,c.value=[],l.value=[],h(t.imageList,!0))},300),W=()=>{a.value&&(t.imageWidth=(a.value.clientWidth-(e.column-1)*e.gap)/e.column,p(t.page,e.pageSize,!0),a.value.addEventListener("scroll",v),window.addEventListener("resize",_))};return I(()=>{W()}),b(()=>{a.value&&a.value.removeEventListener("scroll",v),window.removeEventListener("resize",_)}),(s,o)=>{const n=x;return k((f(),g("div",R,[y("div",{class:"fs-waterfall-content",style:w({overflowY:e.isScroll?"inherit":"scroll"}),ref_key:"contentRef",ref:a},[y("div",C,[(f(!0),g(B,null,F(t.imageList,(i,u)=>(f(),g("div",{class:"fs-waterfall-item",key:i.id,style:w({width:`${t.imageWidth}px`,transform:`translate3d(${c.value[u].x}px, ${c.value[u].y}px, 0)`})},[T(s.$slots,"item",{item:i},void 0,!0)],4))),128))])],4)])),[[n,t.loading]])}}});const N=$(M,[["__scopeId","data-v-e3a3dcfb"]]);export{N as W};
