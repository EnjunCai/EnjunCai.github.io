!function(){function t(t){return function(t){if(Array.isArray(t))return e(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||n(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function r(t,r){return function(t){if(Array.isArray(t))return t}(t)||function(t,r){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var e,i,a,o,c=[],l=!0,s=!1;try{if(a=(n=n.call(t)).next,0===r){if(Object(n)!==n)return;l=!1}else for(;!(l=(e=a.call(n)).done)&&(c.push(e.value),c.length!==r);l=!0);}catch(t){s=!0,i=t}finally{try{if(!l&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(s)throw i}}return c}}(t,r)||n(t,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(t,r){if(t){if("string"==typeof t)return e(t,r);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?e(t,r):void 0}}function e(t,r){(null==r||r>t.length)&&(r=t.length);for(var n=0,e=new Array(r);n<r;n++)e[n]=t[n];return e}System.register([],(function(n,e){"use strict";return{execute:function(){n("r",(function(n,e){e=e||{},n.core.ruler.before("linkify","image_figures",(function(c){for(var l=1,s=function(){var s=c.tokens[u];if("inline"!==s.type)return 0;if(!s.children||1!==s.children.length&&3!==s.children.length)return 0;if(1===s.children.length&&"image"!==s.children[0].type)return 0;if(3===s.children.length){var p=r(s.children,3),h=p[0],y=p[1],d=p[2];if("link_open"!==h.type||"image"!==y.type||"link_close"!==d.type)return 0}if(0!==u&&"paragraph_open"!==c.tokens[u-1].type)return 0;if(u!==f-1&&"paragraph_close"!==c.tokens[u+1].type)return 0;var g,m=c.tokens[u-1];if(m.type="figure_open",m.tag="figure",c.tokens[u+1].type="figure_close",c.tokens[u+1].tag="figure",e.dataType&&c.tokens[u-1].attrPush(["data-type","image"]),e.link&&1===s.children.length){g=r(s.children,1)[0];var v=new c.Token("link_open","a",1);v.attrPush(["href",g.attrGet("src")]),s.children.unshift(v),s.children.push(new c.Token("link_close","a",-1))}if(g=1===s.children.length?s.children[0]:s.children[1],e.figcaption){var b=o(e.figcaption,g);if(b){var k,A=r(n.parseInline(b,c.env),1)[0];s.children.push(new c.Token("figcaption_open","figcaption",1)),(k=s.children).push.apply(k,t(A.children)),s.children.push(new c.Token("figcaption_close","figcaption",-1)),g.attrs&&(g.attrs=i(g.attrs,"title"))}}if(e.copyAttrs&&g.attrs){var w=!0===e.copyAttrs?"":e.copyAttrs;m.attrs=g.attrs.filter((function(t){return r(t,1)[0].match(w)})).map((function(t){return Array.from(t)}))}if(e.tabindex&&(c.tokens[u-1].attrPush(["tabindex",l]),l++),e.lazy&&(g.attrs.some((function(t){return"loading"===r(t,1)[0]}))||g.attrs.push(["loading","lazy"])),e.async&&(g.attrs.some((function(t){return"decoding"===r(t,1)[0]}))||g.attrs.push(["decoding","async"])),e.classes&&"string"==typeof e.classes){for(var S=!1,_=0,T=g.attrs.length;_<T&&!S;_++){var j=g.attrs[_];"class"===j[0]&&(j[1]="".concat(j[1]," ").concat(e.classes),S=!0)}S||g.attrs.push(["class",e.classes])}if(e.removeSrc){var I=g.attrs.find((function(t){return"src"===r(t,1)[0]}));g.attrs.push(["data-src",I[1]]),a(g,"src")}},u=1,f=c.tokens.length;u<f-1;++u)s()}))}));var e=new Set([!0,!1,"alt","title"]);function i(t,n){return(Array.isArray(t)?t:[]).filter((function(t){return r(t,1)[0]!==n}))}function a(t,r){t&&t.attrs&&(t.attrs=i(t.attrs,r))}function o(n,i){if(!e.has(n))throw new TypeError("figcaption must be one of: ".concat(t(e),"."));if("alt"===n)return i.content;var o=i.attrs.find((function(t){return"title"===r(t,1)[0]}));return Array.isArray(o)&&o[1]?(a(i,"title"),o[1]):void 0}}}}))}();
