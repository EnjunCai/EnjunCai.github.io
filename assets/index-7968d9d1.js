import{_ as V}from"./index-1b2d6ce5.js";function y(r){let e=!1;return function(...n){e||(e=!0,window.requestAnimationFrame(()=>{r.apply(this,n),e=!1}))}}function w(r,e=300){let n=null;return function(...s){n&&clearTimeout(n),n=setTimeout(()=>{r.apply(this,s)},e)}}const W={class:"fs-waterfall-container"},L={class:"fs-waterfall-list"},E=Vue.defineComponent({__name:"index",props:{gap:{},column:{},pageSize:{},request:{type:Function},isScroll:{type:Boolean}},setup(r){const e=r,n=Vue.ref(),s=Vue.ref([]),u=Vue.ref([]),t=Vue.reactive({loading:!1,isfinish:!1,page:1,imageWidth:0,imageList:[]});console.log(t.imageList);const h=Vue.computed(()=>{let o=-1,a=1/0;for(let l=0;l<s.value.length;l++){const i=s.value[l];i<a&&(o=l,a=i)}return{minIndex:o,minHeight:a}}),d=async(o,a,l)=>{if(t.isfinish)return;t.loading=!0;const i=await e.request(o,a);if(t.page++,!i.length){t.isfinish=!0;return}g(i,l),t.imageList=[...t.imageList,...i],t.loading=!1},g=(o,a)=>{o.forEach((l,i)=>{const c=Math.floor(l.height*t.imageWidth/l.width);if(a&&i<e.column)u.value.push({x:i%e.column!==0?i*t.imageWidth+e.gap*i:i*t.imageWidth,y:0}),s.value.push(c+e.gap);else{const{minIndex:m,minHeight:_}=h.value;u.value.push({x:m%e.column!==0?m*t.imageWidth+e.gap*m:m*t.imageWidth,y:_}),s.value[m]+=c+e.gap}})},f=y(()=>{const{scrollTop:o,clientHeight:a,scrollHeight:l}=n.value;l-a-o<=100&&!t.loading&&d(t.page,e.pageSize,!1)}),p=w(()=>{n.value&&(t.imageWidth=(n.value.clientWidth-(e.column-1)*e.gap)/e.column,u.value=[],s.value=[],g(t.imageList,!0))},300),v=()=>{n.value&&(t.imageWidth=(n.value.clientWidth-(e.column-1)*e.gap)/e.column,d(t.page,e.pageSize,!0),n.value.addEventListener("scroll",f),window.addEventListener("resize",p))};return Vue.onMounted(()=>{v()}),Vue.onUnmounted(()=>{n.value&&n.value.removeEventListener("scroll",f),window.removeEventListener("resize",p)}),(o,a)=>{const l=Vue.resolveDirective("loading");return Vue.withDirectives((Vue.openBlock(),Vue.createElementBlock("div",W,[Vue.createElementVNode("div",{class:"fs-waterfall-content",style:Vue.normalizeStyle({overflowY:e.isScroll?"inherit":"scroll"}),ref_key:"contentRef",ref:n},[Vue.createElementVNode("div",L,[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(t.imageList,(i,c)=>(Vue.openBlock(),Vue.createElementBlock("div",{class:"fs-waterfall-item",key:i.id,style:Vue.normalizeStyle({width:`${t.imageWidth}px`,transform:`translate3d(${u.value[c].x}px, ${u.value[c].y}px, 0)`})},[Vue.renderSlot(o.$slots,"item",{item:i},void 0,!0)],4))),128))])],4)])),[[l,t.loading]])}}});const S=V(E,[["__scopeId","data-v-e3a3dcfb"]]);export{S as W};
